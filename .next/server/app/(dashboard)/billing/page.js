(()=>{var e={};e.id=921,e.ids=[921],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},71267:e=>{"use strict";e.exports=require("worker_threads")},59796:e=>{"use strict";e.exports=require("zlib")},22922:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>o});var r=a(50482),s=a(69108),n=a(62563),l=a.n(n),i=a(68300),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);a.d(t,d);let o=["",{children:["(dashboard)",{children:["billing",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,3194)),"C:\\_WORK\\_TEMPO\\FINAL\\_APP_v2\\tempo-app-2\\src\\app\\(dashboard)\\billing\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,31959)),"C:\\_WORK\\_TEMPO\\FINAL\\_APP_v2\\tempo-app-2\\src\\app\\(dashboard)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,69361,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,40777)),"C:\\_WORK\\_TEMPO\\FINAL\\_APP_v2\\tempo-app-2\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,69361,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\_WORK\\_TEMPO\\FINAL\\_APP_v2\\tempo-app-2\\src\\app\\(dashboard)\\billing\\page.tsx"],u="/(dashboard)/billing/page",x={require:a,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/(dashboard)/billing/page",pathname:"/billing",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},39171:(e,t,a)=>{Promise.resolve().then(a.bind(a,14609))},1560:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(69224).Z)("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},46064:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(69224).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},14609:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>D});var r=a(95344),s=a(3729),n=a(37121),l=a(89895),i=a(96885),d=a(56815),o=a(71532),c=a(97751),u=a(55794);function x({year:e,month:t,onChange:a}){return(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-1",children:[r.jsx("button",{onClick:()=>{0===t?a(e-1,11):a(e,t-1)},className:"p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors","aria-label":"Previous month",children:r.jsx(o.Z,{className:"w-5 h-5 text-neutral-500"})}),r.jsx("div",{className:"px-4 py-2 min-w-[180px] text-center",children:r.jsx("span",{className:"font-bold text-neutral-900 dark:text-white",children:new Date(e,t,1).toLocaleDateString("en-US",{month:"long",year:"numeric"})})}),r.jsx("button",{onClick:()=>{11===t?a(e+1,0):a(e,t+1)},className:"p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors","aria-label":"Next month",children:r.jsx(c.Z,{className:"w-5 h-5 text-neutral-500"})})]}),!(()=>{let a=new Date;return e===a.getFullYear()&&t===a.getMonth()})()&&(0,r.jsxs)("button",{onClick:()=>{let e=new Date;a(e.getFullYear(),e.getMonth())},className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-primary-600 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-lg transition-colors",children:[r.jsx(u.Z,{className:"w-4 h-4"}),"Today"]})]})}var m=a(46064),p=a(25545),h=a(7060);function b({summary:e,loading:t}){let a=e=>new Intl.NumberFormat("ro-RO",{minimumFractionDigits:0,maximumFractionDigits:0}).format(e),s=[{label:"Total Revenue",value:e.totalRevenue,icon:m.Z,color:"primary",subtitle:"This month"},{label:"Pending",value:e.pendingAmount,count:e.pendingCount,icon:p.Z,color:"warning",subtitle:`${e.pendingCount} invoice${1!==e.pendingCount?"s":""}`},{label:"Collected",value:e.paidAmount,count:e.paidCount,icon:h.Z,color:"success",subtitle:`${e.paidCount} invoice${1!==e.paidCount?"s":""}`}],n={primary:{bg:"bg-primary-50 dark:bg-primary-900/20",text:"text-primary-600"},warning:{bg:"bg-warning-50 dark:bg-warning-900/20",text:"text-warning-600"},success:{bg:"bg-success-50 dark:bg-success-900/20",text:"text-success-600"}};return r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:s.map(e=>{let s=e.icon,l=n[e.color];return(0,r.jsxs)("div",{className:(0,d.W)("bg-white dark:bg-neutral-900 p-6 rounded-2xl border border-neutral-200 dark:border-neutral-800 shadow-sm",t&&"animate-pulse"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("span",{className:"text-sm font-medium text-neutral-500",children:e.label}),r.jsx("div",{className:(0,d.W)("p-2 rounded-lg",l.bg,l.text),children:r.jsx(s,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"flex items-baseline gap-2",children:t?r.jsx("div",{className:"h-9 w-32 bg-neutral-200 dark:bg-neutral-700 rounded"}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("h3",{className:"text-3xl font-bold text-neutral-900 dark:text-white",children:a(e.value)}),r.jsx("span",{className:"text-sm font-medium text-neutral-500",children:"RON"})]})}),r.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:e.subtitle})]},e.label)})})}var g=a(81202),N=a(45961),j=a(42739),y=a(25390),f=a(1560),v=a(76299),k=a(90702),w=a(94061),P=a(81012),I=a(87097);function S({invoices:e,loading:t,onMarkAsPaid:a,onMarkAsPending:l}){let{data:o}=(0,v.HX)(),{success:u,error:x}=(0,w.useToast)(),[m,b]=(0,s.useState)(new Set),[S,C]=(0,s.useState)(null),[_,D]=(0,s.useState)(null),[O,R]=(0,s.useState)(null),F=e=>{let t=new Set(m);t.has(e)?t.delete(e):t.add(e),b(t)},T=(e,t)=>{e.stopPropagation();let a=e.currentTarget.getBoundingClientRect();D(t),C({top:a.bottom+window.scrollY+4,right:window.innerWidth-a.right-window.scrollX})},q=()=>{C(null),D(null)},Z=e=>new Intl.NumberFormat("ro-RO",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e),M=e=>new Date(e).toLocaleDateString("ro-RO",{day:"2-digit",month:"short"}),A=e=>new Date(e).toLocaleTimeString("ro-RO",{hour:"2-digit",minute:"2-digit"}),$=async e=>{if(!o?.clinic){x("Please configure clinic details in Settings > Billing Config first.");return}R(e.clientId),q();try{let t=await (0,I.i3)(P.db,async t=>{let a=(0,I.JU)(P.db,"system_settings","config"),r=await t.get(a);if(!r.exists())throw Error("System settings not found");let s=r.data(),n=(s.invoicing?.currentNumber||0)+1,l=s.invoicing?.seriesPrefix||"INV",i=new Date,d=new Date;d.setDate(i.getDate()+(s.invoicing?.defaultDueDays||14));let o={series:l,number:n,date:i.toISOString().split("T")[0],dueDate:d.toISOString().split("T")[0],clinic:{name:s.clinic.name||"Clinic Name",address:s.clinic.address||"",cui:s.clinic.cui||"",regNo:s.clinic.regNo||"",bank:s.clinic.bank||"",iban:s.clinic.iban||"",email:s.clinic.email||"",phone:s.clinic.phone||""},client:{name:e.clientName,address:"Client Address Placeholder"},items:e.lineItems.map(e=>({description:`${e.serviceLabel} (${M(e.date)})`,quantity:e.duration/60,unit:"hour",price:e.basePrice,amount:e.amount})),total:e.total,currency:"RON"},c=(0,I.JU)((0,I.hJ)(P.db,"invoices"));return t.set(c,{...o,clientId:e.clientId,status:"issued",createdAt:(0,I.Bt)(),formattedDate:i.toLocaleDateString("ro-RO"),formattedDueDate:d.toLocaleDateString("ro-RO")}),t.update(a,{"invoicing.currentNumber":n}),o});u(`Invoice #${t.series}-${t.number} generated and saved.`);let a=(0,k.q)({...t,date:new Date(t.date).toLocaleDateString("ro-RO"),dueDate:new Date(t.dueDate).toLocaleDateString("ro-RO")}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download=`Invoice_${e.clientName}_${t.series}${t.number}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}catch(e){console.error(e),x("Failed to generate invoice: "+e.message)}finally{R(null)}},E=e=>{switch(e){case"paid":return{icon:h.Z,label:"Paid",classes:"bg-success-100 text-success-700 dark:bg-success-900/30 dark:text-success-400"};case"overdue":return{icon:N.Z,label:"Overdue",classes:"bg-error-100 text-error-700 dark:bg-error-900/30 dark:text-error-400"};default:return{icon:p.Z,label:"Pending",classes:"bg-warning-100 text-warning-700 dark:bg-warning-900/30 dark:text-warning-400"}}};return t?r.jsx("div",{className:"bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl p-12 flex items-center justify-center",children:r.jsx(j.Z,{className:"w-8 h-8 animate-spin text-primary-500"})}):0===e.length?(0,r.jsxs)("div",{className:"bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl p-12 text-center",children:[r.jsx(n.Z,{className:"w-12 h-12 text-neutral-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-bold text-neutral-900 dark:text-white mb-2",children:"No billable sessions"}),r.jsx("p",{className:"text-neutral-500",children:"There are no completed sessions to bill for this period."})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden shadow-sm",children:r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-left text-sm",children:[r.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-800/50 text-neutral-500 font-medium",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3 w-8"}),r.jsx("th",{className:"px-6 py-3",children:"Client"}),r.jsx("th",{className:"px-6 py-3 text-center",children:"Sessions"}),r.jsx("th",{className:"px-6 py-3 text-center",children:"Hours"}),r.jsx("th",{className:"px-6 py-3 text-right",children:"Amount"}),r.jsx("th",{className:"px-6 py-3 text-center",children:"Status"}),r.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-neutral-100 dark:divide-neutral-800",children:e.map(e=>{let t=m.has(e.clientId),a=E(e.status),n=a.icon,l=O===e.clientId;return(0,r.jsxs)(s.Fragment,{children:[(0,r.jsxs)("tr",{className:(0,d.W)("hover:bg-neutral-50 dark:hover:bg-neutral-800/50 transition-colors cursor-pointer",t&&"bg-neutral-50 dark:bg-neutral-800/30"),onClick:()=>F(e.clientId),children:[r.jsx("td",{className:"px-6 py-4",children:r.jsx("button",{className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors",children:t?r.jsx(y.Z,{className:"w-4 h-4 text-neutral-500"}):r.jsx(c.Z,{className:"w-4 h-4 text-neutral-500"})})}),r.jsx("td",{className:"px-6 py-4",children:r.jsx("span",{className:"font-medium text-neutral-900 dark:text-white",children:e.clientName})}),(0,r.jsxs)("td",{className:"px-6 py-4 text-center text-neutral-700 dark:text-neutral-300",children:[e.billableSessions,e.excusedSessions>0&&(0,r.jsxs)("span",{className:"text-xs text-neutral-400 ml-1",children:["(+",e.excusedSessions," excused)"]})]}),(0,r.jsxs)("td",{className:"px-6 py-4 text-center text-neutral-700 dark:text-neutral-300",children:[e.totalHours,"h"]}),(0,r.jsxs)("td",{className:"px-6 py-4 text-right",children:[(0,r.jsxs)("span",{className:"font-bold text-neutral-900 dark:text-white",children:[Z(e.total)," RON"]}),e.discount>0&&(0,r.jsxs)("span",{className:"block text-xs text-success-600",children:["-",Z(e.discount)," discount"]})]}),r.jsx("td",{className:"px-6 py-4 text-center",children:(0,r.jsxs)("span",{className:(0,d.W)("inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold",a.classes),children:[r.jsx(n,{className:"w-3.5 h-3.5"}),a.label]})}),r.jsx("td",{className:"px-6 py-4 text-right",onClick:e=>e.stopPropagation(),children:r.jsx("button",{onClick:t=>T(t,e),disabled:l,className:(0,d.W)("p-2 rounded-lg transition-colors disabled:opacity-50",_?.clientId===e.clientId?"bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-white":"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800"),children:l?r.jsx(j.Z,{className:"w-4 h-4 animate-spin"}):r.jsx(f.Z,{className:"w-4 h-4"})})})]}),t&&r.jsx("tr",{children:r.jsx("td",{colSpan:7,className:"px-6 py-4 bg-neutral-50 dark:bg-neutral-800/20",children:(0,r.jsxs)("div",{className:"pl-8 space-y-2",children:[r.jsx("p",{className:"text-xs font-semibold text-neutral-500 uppercase tracking-wider mb-3",children:"Session Breakdown"}),r.jsx("div",{className:"grid gap-2",children:e.lineItems.map((e,t)=>(0,r.jsxs)("div",{className:(0,d.W)("flex items-center justify-between py-2 px-3 rounded-lg border",e.isBillable?"bg-white dark:bg-neutral-900 border-neutral-100 dark:border-neutral-800":"bg-neutral-100 dark:bg-neutral-800/50 border-neutral-200 dark:border-neutral-700 opacity-60"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx("span",{className:"text-sm text-neutral-500 w-20",children:M(e.date)}),r.jsx("span",{className:"text-sm text-neutral-500 w-16",children:A(e.date)}),r.jsx("span",{className:"text-sm font-medium text-neutral-900 dark:text-white",children:e.serviceLabel}),(0,r.jsxs)("span",{className:"text-xs text-neutral-400",children:["(",e.duration," min)"]}),e.attendance&&(0,r.jsxs)("span",{className:(0,d.W)("text-xs px-1.5 py-0.5 rounded font-medium","present"===e.attendance&&"bg-success-100 text-success-700 dark:bg-success-900/30 dark:text-success-400","absent"===e.attendance&&"bg-error-100 text-error-700 dark:bg-error-900/30 dark:text-error-400","excused"===e.attendance&&"bg-neutral-200 text-neutral-600 dark:bg-neutral-700 dark:text-neutral-400"),children:["present"===e.attendance&&"Present","absent"===e.attendance&&"No-show","excused"===e.attendance&&"Excused"]})]}),r.jsx("span",{className:(0,d.W)("text-sm font-medium",e.isBillable?"text-neutral-700 dark:text-neutral-300":"text-neutral-400 line-through"),children:e.isBillable?`${Z(e.amount)} RON`:"Not billed"})]},t))}),e.discount>0&&(0,r.jsxs)("div",{className:"flex items-center justify-between py-2 px-3 mt-2 border-t border-neutral-200 dark:border-neutral-700",children:[r.jsx("span",{className:"text-sm text-neutral-500",children:"Subtotal"}),(0,r.jsxs)("span",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:[Z(e.subtotal)," RON"]})]}),e.discount>0&&(0,r.jsxs)("div",{className:"flex items-center justify-between py-2 px-3",children:[r.jsx("span",{className:"text-sm text-success-600",children:"Discount"}),(0,r.jsxs)("span",{className:"text-sm text-success-600",children:["-",Z(e.discount)," RON"]})]})]})})},`${e.clientId}-details`)]},e.clientId)})})]})})}),S&&_&&"undefined"!=typeof document&&(0,g.createPortal)((0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-[100] bg-transparent",onClick:q}),(0,r.jsxs)("div",{className:"fixed z-[101] w-48 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-xl shadow-xl py-1 animate-in fade-in zoom-in-95 duration-100",style:{top:S.top,right:S.right},children:[(0,r.jsxs)("button",{onClick:()=>$(_),className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-primary-600 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors font-medium",children:[r.jsx(i.Z,{className:"w-4 h-4"}),"Generate Invoice"]}),r.jsx("div",{className:"my-1 border-t border-neutral-100 dark:border-neutral-700"}),"paid"===_.status?(0,r.jsxs)("button",{onClick:()=>{l?.(_.clientId),q()},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors",children:[r.jsx(p.Z,{className:"w-4 h-4"}),"Mark Pending"]}):(0,r.jsxs)("button",{onClick:()=>{"pending"!==_.status&&(a?.(_.clientId),q())},disabled:"pending"===_.status,title:"pending"===_.status?"Generate Invoice first":"Mark as Paid",className:(0,d.W)("w-full flex items-center gap-2 px-3 py-2 text-sm transition-colors","pending"===_.status?"text-neutral-400 cursor-not-allowed":"text-success-600 hover:bg-success-50 dark:hover:bg-success-900/20"),children:[r.jsx(h.Z,{className:"w-4 h-4"}),"Mark as Paid"]}),(0,r.jsxs)("button",{onClick:q,className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors",children:[r.jsx(n.Z,{className:"w-4 h-4"}),"View Details"]})]})]}),document.body)]})}var C=a(66138);function _({payouts:e,loading:t}){let a=e=>new Intl.NumberFormat("ro-RO",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e),s=e.reduce((e,t)=>e+t.calculatedPayout,0),n=e.reduce((e,t)=>e+t.totalHours,0),i=e.reduce((e,t)=>e+t.sessions,0);if(t)return r.jsx("div",{className:"bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl p-12 flex items-center justify-center",children:r.jsx(j.Z,{className:"w-8 h-8 animate-spin text-primary-500"})});if(0===e.length)return(0,r.jsxs)("div",{className:"bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl p-12 text-center",children:[r.jsx(l.Z,{className:"w-12 h-12 text-neutral-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-bold text-neutral-900 dark:text-white mb-2",children:"No sessions recorded"}),r.jsx("p",{className:"text-neutral-500",children:"There are no sessions to calculate payouts for this period."})]});let o=e.some(e=>0===e.hourlyRate);return(0,r.jsxs)("div",{className:"space-y-4",children:[o&&(0,r.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-xl",children:[r.jsx(C.Z,{className:"w-5 h-5 text-warning-600 flex-shrink-0 mt-0.5"}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-warning-800 dark:text-warning-200",children:"Missing hourly rates"}),r.jsx("p",{className:"text-xs text-warning-600 dark:text-warning-400 mt-0.5",children:"Some team members don't have hourly rates set. Update their profiles in the Team section."})]})]}),r.jsx("div",{className:"bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden shadow-sm",children:r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-left text-sm",children:[r.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-800/50 text-neutral-500 font-medium",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3",children:"Team Member"}),r.jsx("th",{className:"px-6 py-3 text-center",children:"Sessions"}),r.jsx("th",{className:"px-6 py-3 text-center",children:"Hours"}),r.jsx("th",{className:"px-6 py-3 text-right",children:"Rate/Hour"}),r.jsx("th",{className:"px-6 py-3 text-right",children:"Payout"})]})}),r.jsx("tbody",{className:"divide-y divide-neutral-100 dark:divide-neutral-800",children:e.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-neutral-50 dark:hover:bg-neutral-800/50 transition-colors",children:[r.jsx("td",{className:"px-6 py-4",children:r.jsx("span",{className:"font-medium text-neutral-900 dark:text-white",children:e.odName})}),r.jsx("td",{className:"px-6 py-4 text-center text-neutral-700 dark:text-neutral-300",children:e.sessions}),(0,r.jsxs)("td",{className:"px-6 py-4 text-center text-neutral-700 dark:text-neutral-300",children:[e.totalHours,"h"]}),r.jsx("td",{className:"px-6 py-4 text-right",children:e.hourlyRate>0?(0,r.jsxs)("span",{className:"text-neutral-700 dark:text-neutral-300",children:[a(e.hourlyRate)," RON"]}):r.jsx("span",{className:"text-warning-600 text-xs font-medium",children:"Not set"})}),r.jsx("td",{className:"px-6 py-4 text-right",children:(0,r.jsxs)("span",{className:(0,d.W)("font-bold",e.calculatedPayout>0?"text-neutral-900 dark:text-white":"text-neutral-400"),children:[a(e.calculatedPayout)," RON"]})})]},e.odId))}),r.jsx("tfoot",{className:"bg-neutral-50 dark:bg-neutral-800/50 font-medium",children:(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"px-6 py-4 text-neutral-700 dark:text-neutral-300",children:"Total"}),r.jsx("td",{className:"px-6 py-4 text-center text-neutral-700 dark:text-neutral-300",children:i}),(0,r.jsxs)("td",{className:"px-6 py-4 text-center text-neutral-700 dark:text-neutral-300",children:[Math.round(10*n)/10,"h"]}),r.jsx("td",{className:"px-6 py-4"}),r.jsx("td",{className:"px-6 py-4 text-right",children:(0,r.jsxs)("span",{className:"font-bold text-neutral-900 dark:text-white",children:[a(s)," RON"]})})]})})]})})})]})}function D(){let{success:e,error:t}=(0,w.useToast)(),a=new Date,[o,c]=(0,s.useState)(a.getFullYear()),[u,m]=(0,s.useState)(a.getMonth()),[p,h]=(0,s.useState)("invoices"),{data:g,loading:N}=(0,v.Nx)(o,u),{data:j,loading:y}=(0,v.bI)(o,u),{data:f,loading:k}=(0,v.av)(),{data:C,loading:D}=(0,v.Su)(),{data:O,loading:R}=(0,v.lU)(),F=N||k||D||R||y,T=(0,s.useMemo)(()=>F?[]:function(e,t,a,r=[]){let s=new Map;e.forEach(e=>{if(!e.clientId||!e.attendance)return;let t=s.get(e.clientId)||[];t.push(e),s.set(e.clientId,t)});let n=[];return s.forEach((e,s)=>{let l=t.find(e=>e.id===s);if(!l)return;let i=[],d=0;if(e.forEach(e=>{let t=a.find(t=>t.id===e.type),r=t?.basePrice||0;if(!(t?.isBillable!==!1))return;let s=e.duration||60,n=e.attendance,l="present"===n||"absent"===n;i.push({eventId:e.id,date:e.startTime,serviceType:e.type,serviceLabel:t?.label||e.type,duration:s,basePrice:r,amount:l?s/60*r:0,attendance:n,isBillable:l}),l&&(d+=s)}),0===i.length)return;let o=i.filter(e=>e.isBillable),c=i.filter(e=>!e.isBillable).length,u=o.reduce((e,t)=>e+t.amount,0),x=u*(l.discountRate||0),m=r.find(e=>e.clientId===s),p=m?m.status:"pending";n.push({clientId:s,invoiceId:m?.id,clientName:l.name,sessions:i.length,billableSessions:o.length,excusedSessions:c,totalHours:Math.round(d/60*10)/10,lineItems:i,subtotal:u,discount:x,total:u-x,status:p})}),n.sort((e,t)=>t.total-e.total),n}(g,f,C,j),[g,f,C,j,F]),q=(0,s.useMemo)(()=>F?[]:function(e,t){let a=new Map;e.forEach(e=>{if(!e.odId&&!e.therapistId)return;let t=e.odId||e.therapistId,r=a.get(t)||[];r.push(e),a.set(t,r)});let r=[];return a.forEach((e,a)=>{let s=t.find(e=>e.id===a);if(!s)return;let n=0,l=0;e.forEach(e=>{n+=e.duration||60,l++});let i=s.hourlyRate||0,d=Math.round(n/60*10)/10;r.push({odId:a,odName:s.name,sessions:l,totalHours:d,hourlyRate:i,calculatedPayout:d*i})}),r.sort((e,t)=>t.calculatedPayout-e.calculatedPayout),r}(g,O),[g,O,F]),Z=(0,s.useMemo)(()=>{let e,t,a,r,s;return e=0,t=0,a=0,r=0,s=0,T.forEach(n=>{e+=n.total,"paid"===n.status?(a+=n.total,s++):(t+=n.total,r++)}),{totalRevenue:e,pendingAmount:t,paidAmount:a,pendingCount:r,paidCount:s}},[T]),M=async a=>{try{let r=(0,I.IO)((0,I.hJ)(P.db,"invoices"),(0,I.ar)("clientId","==",a),(0,I.ar)("status","==","issued")),s=await (0,I.PL)(r);if(s.empty){t("Cannot mark as paid: Invoice not generated yet.");return}let n=s.docs.map(e=>(0,I.r7)((0,I.JU)(P.db,"invoices",e.id),{status:"paid",paidAt:new Date().toISOString()}));await Promise.all(n),e("Invoice marked as paid.")}catch(e){console.error(e),t("Failed to update invoice status.")}},A=async a=>{try{let t=(0,I.IO)((0,I.hJ)(P.db,"invoices"),(0,I.ar)("clientId","==",a),(0,I.ar)("status","==","paid")),r=(await (0,I.PL)(t)).docs.map(e=>(0,I.r7)((0,I.JU)(P.db,"invoices",e.id),{status:"issued",paidAt:null}));await Promise.all(r),e("Invoice marked as pending.")}catch(e){console.error(e),t("Failed to update status.")}},$=[{id:"invoices",label:"Client Invoices",icon:n.Z,count:T.length},{id:"payouts",label:"Team Payouts",icon:l.Z,count:q.length}];return(0,r.jsxs)("div",{className:"flex-1 p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-neutral-900 dark:text-white",children:"Billing"}),r.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Manage client invoices and team payouts"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx(x,{year:o,month:u,onChange:(e,t)=>{c(e),m(t)}}),(0,r.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 border border-neutral-200 dark:border-neutral-700 rounded-xl hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors text-sm font-medium",children:[r.jsx(i.Z,{className:"w-4 h-4"}),"Export"]})]})]}),r.jsx(b,{summary:Z,loading:F}),r.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-800",children:r.jsx("div",{className:"flex items-center gap-1",children:$.map(e=>{let t=e.icon;return(0,r.jsxs)("button",{onClick:()=>h(e.id),className:(0,d.W)("flex items-center gap-2 px-4 py-3 text-sm font-medium transition-all relative",p===e.id?"text-primary-600 dark:text-primary-400":"text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300"),children:[r.jsx(t,{className:"w-4 h-4"}),e.label,r.jsx("span",{className:(0,d.W)("px-2 py-0.5 rounded-full text-xs font-bold",p===e.id?"bg-primary-100 dark:bg-primary-900/30 text-primary-600":"bg-neutral-100 dark:bg-neutral-800 text-neutral-500"),children:e.count}),p===e.id&&r.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary-500"})]},e.id)})})}),(0,r.jsxs)("div",{className:"pt-2",children:["invoices"===p&&r.jsx(S,{invoices:T,loading:F,onMarkAsPaid:M,onMarkAsPending:A}),"payouts"===p&&r.jsx(_,{payouts:q,loading:F})]})]})}},90702:(e,t,a)=>{"use strict";a.d(t,{q:()=>n});var r=a(67898),s=a(4071);let n=e=>{let t=new r.ZP;t.setFontSize(20),t.text("INVOICE",150,20),t.setFontSize(10),t.text(`Series: ${e.series}`,150,30),t.text(`Number: ${e.number}`,150,35),t.text(`Date: ${e.date}`,150,40),t.text(`Due Date: ${e.dueDate}`,150,45),t.setFontSize(12),t.setFont("helvetica","bold"),t.text(e.clinic.name,14,20),t.setFont("helvetica","normal"),t.setFontSize(10);let a=25;t.text(e.clinic.address,14,a+=5,{maxWidth:80}),a+=(t.splitTextToSize(e.clinic.address,80).length-1)*5,t.text(`CUI: ${e.clinic.cui}`,14,a+=5),t.text(`Reg. Com: ${e.clinic.regNo}`,14,a+=5),t.text(`Bank: ${e.clinic.bank}`,14,a+=5),t.text(`IBAN: ${e.clinic.iban}`,14,a+=5),t.text(`Email: ${e.clinic.email}`,14,a+=5),t.setFont("helvetica","bold"),t.text("Bill To:",150,60),t.setFont("helvetica","normal"),t.text(e.client.name,150,65),e.client.address&&t.text(e.client.address,150,70,{maxWidth:50});let n=Math.max(a+15,90);(0,s.ZP)(t,{startY:n,head:[["Description","Qty","Unit","Price","Amount"]],body:e.items.map(e=>[e.description,e.quantity,e.unit,e.price.toFixed(2),e.amount.toFixed(2)]),theme:"striped",headStyles:{fillColor:[74,144,226]},foot:[["","","","Total",`${e.total.toFixed(2)} ${e.currency}`]],footStyles:{fillColor:[240,240,240],textColor:[0,0,0],fontStyle:"bold"}});let l=t.lastAutoTable.finalY+20;return t.setFontSize(10),t.text("Thank you for your business!",14,l),t.setFontSize(8),t.text("This invoice was generated automatically by TempoApp.",14,280),t.output("blob")}},3194:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>n,__esModule:()=>s,default:()=>l});let r=(0,a(86843).createProxy)(String.raw`C:\_WORK\_TEMPO\FINAL\_APP_v2\tempo-app-2\src\app\(dashboard)\billing\page.tsx`),{__esModule:s,$$typeof:n}=r,l=r.default}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[960,506,218,605,557],()=>a(22922));module.exports=r})();