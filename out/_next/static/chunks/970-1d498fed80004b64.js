"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[970],{18628:function(e,t,n){n.r(t),n.d(t,{AuthProvider:function(){return u},useAuth:function(){return d}});var r=n(3827),i=n(64090),a=n(27065),o=n(1221),c=n(58121),s=n(47907);let l=(0,i.createContext)({});function u(e){let{children:t}=e,[n,u]=(0,i.useState)(null),[d,g]=(0,i.useState)(null),[f,p]=(0,i.useState)(null),[h,m]=(0,i.useState)(!0),y=(0,s.useRouter)();(0,i.useEffect)(()=>{let e=null,t=(0,a.Aj)(o.I8,async t=>{u(t),e&&(e(),e=null),t?e=(0,c.cf)((0,c.JU)(o.db,"team_members",t.uid),e=>{if(e.exists()){let t=e.data();g(t),p(t.role),m(!1)}else(0,c.cf)((0,c.JU)(o.db,"clients",t.uid),e=>{e.exists()?(g(e.data()),p("Parent")):(g(null),p(null)),m(!1)})}):(g(null),p(null),m(!1))});return()=>{t(),e&&e()}},[y]);let v=async(e,t)=>{await (0,a.e5)(o.I8,e,t)},S=async()=>{await (0,a.w7)(o.I8),y.push("/login")};return(0,r.jsx)(l.Provider,{value:{user:n,userData:d,userRole:f,loading:h,signIn:v,signOut:S},children:!h&&t})}let d=()=>(0,i.useContext)(l)},19685:function(e,t,n){n.r(t),n.d(t,{ToastProvider:function(){return m},useToast:function(){return y}});var r=n(3827),i=n(64090),a=n(89542),o=n(46578),c=n(98998),s=n(61524),l=n(28814),u=n(52235),d=n(75504);let g={success:o.Z,error:c.Z,warning:s.Z,info:l.Z},f={success:"bg-success-500 border-success-600 text-white",error:"bg-error-500 border-error-600 text-white",warning:"bg-warning-500 border-warning-600 text-white",info:"bg-primary-500 border-primary-600 text-white"};function p(e){let{id:t,message:n,type:a,duration:o=5e3,onDismiss:c}=e,s=g[a];return(0,i.useEffect)(()=>{console.log("Toast mounted:",t);let e=setTimeout(()=>{c(t)},o);return()=>clearTimeout(e)},[o,t,c]),(0,r.jsxs)("div",{className:(0,d.W)("flex items-start gap-3 p-4 rounded-lg shadow-lg border w-80 pointer-events-auto z-[9999]",f[a]),role:"alert",children:[(0,r.jsx)(s,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),(0,r.jsx)("div",{className:"flex-1 text-sm font-medium",children:n}),(0,r.jsx)("button",{onClick:()=>c(t),className:"text-white/80 hover:text-white transition-colors",children:(0,r.jsx)(u.Z,{className:"w-4 h-4"})})]})}let h=(0,i.createContext)(void 0);function m(e){let{children:t}=e,[n,o]=(0,i.useState)([]),[c,s]=(0,i.useState)(!1);(0,i.useEffect)(()=>{s(!0)},[]);let l=(0,i.useCallback)(e=>{o(t=>t.filter(t=>t.id!==e))},[]),u=(0,i.useCallback)(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;console.log("Showing toast:",e,t);let r=Math.random().toString(36).substring(2,9);o(i=>[...i,{id:r,message:e,type:t,duration:n,onDismiss:l}])},[l]),d=(0,i.useCallback)((e,t)=>u(e,"success",t),[u]),g=(0,i.useCallback)((e,t)=>u(e,"error",t),[u]),f=(0,i.useCallback)((e,t)=>u(e,"warning",t),[u]),m=(0,i.useCallback)((e,t)=>u(e,"info",t),[u]);return(0,r.jsxs)(h.Provider,{value:{showToast:u,success:d,error:g,warning:f,info:m},children:[t,c&&"undefined"!=typeof document&&(0,a.createPortal)((0,r.jsx)("div",{className:"fixed top-4 right-4 flex flex-col gap-2 max-h-screen pointer-events-none",style:{zIndex:999999},children:n.map(e=>(0,r.jsx)("div",{className:"pointer-events-auto animate-in slide-in-from-right-full fade-in duration-300",children:(0,r.jsx)(p,{...e})},e.id))}),document.body)]})}function y(){let e=(0,i.useContext)(h);if(!e)throw Error("useToast must be used within a ToastProvider");return e}},2335:function(e,t,n){n.d(t,{HX:function(){return h},Nx:function(){return f},Rn:function(){return p},Su:function(){return u},av:function(){return s},b$:function(){return d},bI:function(){return y},gV:function(){return v},hI:function(){return c},lU:function(){return l},we:function(){return g},wm:function(){return m}});var r=n(64090),i=n(58121),a=n(1221);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],[n,o]=(0,r.useState)([]),[c,s]=(0,r.useState)(!0),[l,u]=(0,r.useState)(null);return(0,r.useEffect)(()=>{s(!0);let n=(0,i.IO)((0,i.hJ)(a.db,e),...t),r=(0,i.cf)(n,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t),s(!1)},t=>{console.error("Error fetching ".concat(e,":"),t),u(t.message),s(!1)});return()=>r()},[e]),{data:n,loading:c,error:l}}function c(){return o("events")}function s(){return o("clients")}function l(){return o("team_members")}function u(){return o("services")}function d(){return o("programs")}function g(e){let[t,n]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[s,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e){c(!1);return}let t=(0,i.IO)((0,i.hJ)(a.db,"events"),(0,i.ar)("clientId","==",e),(0,i.Xo)("startTime","asc")),r=(0,i.cf)(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),n(t),c(!1)},e=>{console.error("Error fetching client events:",e),l(e.message),c(!1)});return()=>r()},[e]),{data:t,loading:o,error:s}}function f(e,t){let[n,o]=(0,r.useState)([]),[c,s]=(0,r.useState)(!0),[l,u]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let n=new Date(e,t,1),r=new Date(e,t+1,0,23,59,59,999),c=(0,i.IO)((0,i.hJ)(a.db,"events"),(0,i.ar)("startTime",">=",n.toISOString()),(0,i.ar)("startTime","<=",r.toISOString()),(0,i.Xo)("startTime","asc")),l=(0,i.cf)(c,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t),s(!1)},e=>{console.error("Error fetching events by month:",e),u(e.message),s(!1)});return()=>l()},[e,t]),{data:n,loading:c,error:l}}function p(e){let[t,n]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[s,l]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!e){n([]),c(!1);return}let t=(0,i.IO)((0,i.hJ)(a.db,"clients",e,"interventionPlans"),(0,i.Xo)("createdAt","desc")),r=(0,i.cf)(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),n(t),c(!1)},e=>{console.error("Error fetching intervention plans:",e),l(e.message),c(!1)});return()=>r()},[e]);let u=t.find(e=>"active"===e.status)||null;return{data:t,loading:o,error:s,activePlan:u,getActivePlanForDate:e=>t.find(t=>{if("active"!==t.status)return!1;let n=new Date(t.startDate),r=new Date(t.endDate);return r.setHours(23,59,59,999),e>=n&&e<=r})||null}}function h(){let[e,t]=(0,r.useState)(null),[n,o]=(0,r.useState)(!0),[c,s]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=(0,i.cf)((0,i.JU)(a.db,"system_settings","config"),e=>{e.exists()?t(e.data()):t(null),o(!1)},e=>{console.error("Error fetching system settings:",e),s(e.message),o(!1)});return()=>e()},[]),{data:e,loading:n,error:c}}function m(e){let[t,n]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[s,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e){c(!1);return}let t=(0,i.IO)((0,i.hJ)(a.db,"invoices"),(0,i.ar)("clientId","==",e),(0,i.Xo)("date","desc")),r=(0,i.cf)(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),n(t),c(!1)},e=>{console.error("Error fetching client invoices:",e),l(e.message),c(!1)});return()=>r()},[e]),{data:t,loading:o,error:s}}function y(e,t){let[n,o]=(0,r.useState)([]),[c,s]=(0,r.useState)(!0),[l,u]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let n="".concat(e,"-").concat(String(t+1).padStart(2,"0"),"-01"),r="".concat(e,"-").concat(String(t+1).padStart(2,"0"),"-31"),c=(0,i.IO)((0,i.hJ)(a.db,"invoices"),(0,i.ar)("date",">=",n),(0,i.ar)("date","<=",r),(0,i.Xo)("date","desc")),l=(0,i.cf)(c,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t),s(!1)},e=>{console.error("Error fetching monthly invoices:",e),u(e.message),s(!1)});return()=>l()},[e,t]),{data:n,loading:c,error:l}}function v(e,t){let[n,o]=(0,r.useState)([]),[c,s]=(0,r.useState)(!0),[l,u]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let n="".concat(e,"-").concat(String(t+1).padStart(2,"0")),r=(0,i.IO)((0,i.hJ)(a.db,"payouts"),(0,i.ar)("month","==",n)),c=(0,i.cf)(r,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t),s(!1)},e=>{console.error("Error fetching monthly payouts:",e),u(e.message),s(!1)});return()=>c()},[e,t]),{data:n,loading:c,error:l}}},1221:function(e,t,n){n.d(t,{Fw:function(){return g},I8:function(){return l},db:function(){return u},tO:function(){return d}});var r=n(26142),i=n(27065),a=n(58121),o=n(24905),c=n(76079);let s=0===(0,r.C6)().length?(0,r.ZF)({apiKey:"AIzaSyBLyN1jo8PpJ5OMtkEuC4auhuuviapB3Bs",authDomain:"tempo-app-2.firebaseapp.com",projectId:"tempo-app-2",storageBucket:"tempo-app-2.firebasestorage.app",messagingSenderId:"47813899076",appId:"1:47813899076:web:cd597912a0755195241d11"}):(0,r.C6)()[0],l=(0,i.v0)(s),u=(0,a.ad)(s),d=(0,o.cF)(s),g=(0,c.KL)(s)},12228:function(e,t,n){n.d(t,{EK:function(){return l},FD:function(){return s},Im:function(){return f},LI:function(){return p},Q_:function(){return y},Wg:function(){return d},ag:function(){return u},bP:function(){return o},co:function(){return v},ct:function(){return g},i0:function(){return c},iK:function(){return m},kE:function(){return h}});var r=n(58121),i=n(1221);async function a(e){let t={...e,createdAt:r.EK.now(),read:!1};console.log("[NotificationService] Creating notification:",t);let n=await (0,r.ET)((0,r.hJ)(i.db,"notifications"),t);return console.log("[NotificationService] Created notification with ID:",n.id),n.id}async function o(e){if(0===e.length){console.log("[NotificationService] No notifications to create (empty array)");return}console.log("[NotificationService] Creating batch of",e.length,"notifications"),console.log("[NotificationService] Recipients:",e.map(e=>e.recipientId));let t=(0,r.qs)(i.db);e.forEach(e=>{let n=(0,r.JU)((0,r.hJ)(i.db,"notifications"));t.set(n,{...e,createdAt:r.EK.now(),read:!1})}),await t.commit(),console.log("[NotificationService] Batch committed successfully")}async function c(e,t){let n=new Date(t.startTime),r=n.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),i=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),a=e.filter(e=>e!==t.triggeredByUserId).map(e=>({recipientId:e,recipientRole:"therapist",type:"schedule_created",category:"schedule",title:"New Session Scheduled",message:"".concat(t.eventType," session").concat(t.clientName?" with ".concat(t.clientName):""," on ").concat(r," at ").concat(i),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Calendar",type:"navigate",route:"/calendar"}]}));await o(a)}async function s(e,t){let n=new Date(t.startTime);t.oldStartTime;let r=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),i=n.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),a=e.filter(e=>e!==t.triggeredByUserId).map(e=>({recipientId:e,recipientRole:"therapist",type:"schedule_updated",category:"schedule",title:"Session Rescheduled",message:"".concat(t.eventType).concat(t.clientName?" with ".concat(t.clientName):""," moved to ").concat(i," at ").concat(r),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Calendar",type:"navigate",route:"/calendar"}]}));await o(a)}async function l(e,t){let n=new Date(t.startTime).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),r=e.filter(e=>e!==t.triggeredByUserId).map(e=>({recipientId:e,recipientRole:"therapist",type:"schedule_cancelled",category:"schedule",title:"Session Cancelled",message:"".concat(t.eventType).concat(t.clientName?" with ".concat(t.clientName):""," on ").concat(n," has been cancelled"),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Calendar",type:"navigate",route:"/calendar"}]}));await o(r)}async function u(e,t){let n=e.filter(e=>e!==t.triggeredByUserId).map(e=>({recipientId:e,recipientRole:"admin",type:"attendance_logged",category:"attendance",title:"Attendance Logged",message:"".concat(t.clientName||"Client"," marked as ").concat(t.attendance," for ").concat(t.eventType," session"),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Details",type:"navigate",route:"/calendar"}]}));await o(n)}async function d(e,t){e!==t.triggeredByUserId&&await a({recipientId:e,recipientRole:"therapist",type:"client_assigned",category:"client",title:"New Client Assigned",message:"You have been assigned to work with ".concat(t.clientName),sourceType:"client",sourceId:t.clientId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Client",type:"navigate",route:"/clients"}]})}async function g(e){try{var t;let n=await (0,r.QT)((0,r.JU)(i.db,"clients",e));if(!n.exists())return console.log("[NotificationService] Client not found:",e),[];let a=(null===(t=n.data())||void 0===t?void 0:t.parentUids)||[];return console.log("[NotificationService] Found parent UIDs for client",e,":",a),a}catch(e){return console.error("[NotificationService] Error getting parent UIDs:",e),[]}}async function f(e,t){let n=await g(e);if(0===n.length){console.log("[NotificationService] No parent UIDs found for client:",e);return}let r=new Date(t.startTime),i=r.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),a=r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),c=n.map(e=>({recipientId:e,recipientRole:"parent",type:"schedule_created",category:"schedule",title:"New Session Scheduled",message:"".concat(t.eventType," session").concat(t.therapistName?" with ".concat(t.therapistName):""," on ").concat(i," at ").concat(a),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Schedule",type:"navigate",route:"/parent/calendar/"}]}));await o(c),console.log("[NotificationService] Sent session created notifications to",n.length,"parents")}async function p(e,t){let n=await g(e);if(0===n.length)return;let r=new Date(t.startTime),i=r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),a=r.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),c=n.map(e=>({recipientId:e,recipientRole:"parent",type:"schedule_updated",category:"schedule",title:"Session Rescheduled",message:"".concat(t.eventType," session moved to ").concat(a," at ").concat(i),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Schedule",type:"navigate",route:"/parent/calendar/"}]}));await o(c),console.log("[NotificationService] Sent session rescheduled notifications to",n.length,"parents")}async function h(e,t){let n=await g(e);if(0===n.length)return;let r=new Date(t.startTime).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),i=n.map(e=>({recipientId:e,recipientRole:"parent",type:"schedule_cancelled",category:"schedule",title:"Session Cancelled",message:"".concat(t.eventType," session on ").concat(r," has been cancelled"),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Schedule",type:"navigate",route:"/parent/calendar/"}]}));await o(i),console.log("[NotificationService] Sent session cancelled notifications to",n.length,"parents")}async function m(e,t){let n=await g(e);if(0===n.length)return;let r=new Date(t.startTime).toLocaleDateString("en-US",{month:"short",day:"numeric"}),i=n.map(e=>({recipientId:e,recipientRole:"parent",type:"attendance_logged",category:"attendance",title:"Session Complete",message:"".concat(t.eventType," session on ").concat(r," - Attendance: ").concat(t.attendance),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Progress",type:"navigate",route:"/parent/progress/"}]}));await o(i),console.log("[NotificationService] Sent attendance notifications to",n.length,"parents")}async function y(e,t){let n=await g(e);if(0===n.length)return;let r=n.map(e=>({recipientId:e,recipientRole:"parent",type:"billing_generated",category:"billing",title:"Invoice Ready",message:"Your ".concat(t.period," invoice is ready (").concat(t.amount.toFixed(2)," RON)"),sourceType:"billing",sourceId:t.invoiceId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Invoice",type:"navigate",route:"/parent/billing/"}]}));await o(r),console.log("[NotificationService] Sent invoice notifications to",n.length,"parents")}async function v(e,t){let n=await g(e);if(0===n.length){console.log("[NotificationService] No parent UIDs found for client:",e);return}let r=n.map(e=>({recipientId:e,recipientRole:"parent",type:"document_shared",category:"client",title:"New Document Available",message:"".concat(t.sharedByName," shared a ").concat(t.documentCategory.toLowerCase(),': "').concat(t.documentName,'"'),sourceType:"client",sourceId:t.documentId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Documents",type:"navigate",route:"/parent/docs/"}]}));await o(r),console.log("[NotificationService] Sent document shared notifications to",n.length,"parents")}}}]);