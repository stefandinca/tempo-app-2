"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[730],{30028:function(e,t,l){l.d(t,{Z:function(){return d}});var a=l(3827),r=l(7944),n=l(75504),s=l(70094),i=l(28670),o=l(12535);function d(e){let{threads:t,activeThreadId:l,onSelectThread:d,onNewChat:c}=e,{t:u}=(0,o.$G)(),{user:x}=(0,r.q)();return(0,a.jsxs)("div",{className:"w-full lg:w-80 border-r border-neutral-200 dark:border-neutral-800 flex flex-col bg-white dark:bg-neutral-900",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"font-bold text-lg text-neutral-900 dark:text-white",children:u("chat.title")}),(0,a.jsx)("button",{onClick:c,className:"p-2 rounded-full bg-primary-50 dark:bg-primary-900/20 text-primary-600 hover:bg-primary-100 transition-colors",children:(0,a.jsx)(s.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(i.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400"}),(0,a.jsx)("input",{type:"text",placeholder:u("chat.search_placeholder"),className:"w-full pl-10 pr-4 py-2 bg-neutral-100 dark:bg-neutral-800 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all"})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[t.map(e=>{var t,r;let s=e.participants.find(e=>e!==(null==x?void 0:x.uid)),i=e.participantDetails[s||""],o=e.lastMessage&&!e.lastMessage.readBy.includes((null==x?void 0:x.uid)||"");return(0,a.jsxs)("button",{onClick:()=>d(e.id),className:(0,n.W)("w-full p-4 flex items-start gap-3 hover:bg-neutral-50 dark:hover:bg-neutral-800/50 transition-colors text-left border-b border-neutral-50 dark:border-neutral-800/50",l===e.id&&"bg-primary-50/50 dark:bg-primary-900/10 border-l-4 border-l-primary-500"),children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full flex-shrink-0 flex items-center justify-center text-white font-bold shadow-sm overflow-hidden",style:{backgroundColor:(null==i?void 0:i.photoURL)?"transparent":(null==i?void 0:i.color)||"#ccc"},children:(null==i?void 0:i.photoURL)?(0,a.jsx)("img",{src:i.photoURL,alt:i.name,className:"w-full h-full object-cover"}):(null==i?void 0:i.initials)||"??"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("h3",{className:(0,n.W)("font-bold text-sm truncate",o?"text-neutral-900 dark:text-white":"text-neutral-700 dark:text-neutral-300"),children:(null==i?void 0:i.name)||u("common.unknown")}),(0,a.jsx)("span",{className:"text-[10px] text-neutral-400",children:null===(t=e.updatedAt)||void 0===t?void 0:t.toDate().toLocaleDateString([],{month:"short",day:"numeric"})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:(0,n.W)("text-xs truncate pr-4",o?"font-bold text-neutral-900 dark:text-white":"text-neutral-500 dark:text-neutral-400"),children:(null===(r=e.lastMessage)||void 0===r?void 0:r.text)||u("chat.started_conversation")}),o&&(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-primary-500 flex-shrink-0"})]})]})]},e.id)}),0===t.length&&(0,a.jsxs)("div",{className:"text-center py-12 px-4",children:[(0,a.jsx)("p",{className:"text-sm text-neutral-500",children:u("chat.no_conversations")}),(0,a.jsx)("button",{onClick:c,className:"mt-2 text-sm text-primary-600 font-medium hover:underline",children:u("chat.start_chatting")})]})]})]})}},99467:function(e,t,l){l.d(t,{Z:function(){return g}});var a=l(3827),r=l(64090),n=l(7944),s=l(53311),i=l(75504);function o(e){var t;let{message:l}=e,{user:r}=(0,n.q)(),s=l.senderId===(null==r?void 0:r.uid);return(0,a.jsx)("div",{className:(0,i.W)("flex w-full mb-4 animate-in fade-in slide-in-from-bottom-2 duration-300",s?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:(0,i.W)("max-w-[75%] px-4 py-2 rounded-2xl shadow-sm",s?"bg-primary-500 text-white rounded-tr-none":"bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 rounded-tl-none"),children:[(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:l.text}),(0,a.jsx)("p",{className:(0,i.W)("text-[10px] mt-1 text-right opacity-70",s?"text-primary-100":"text-neutral-500"),children:(null===(t=l.timestamp)||void 0===t?void 0:t.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))||"sending..."})]})})}var d=l(28814),c=l(53879),u=l(96399),x=l(18994),m=l(85904),h=l(29369),p=l(79990),f=l(19685),b=l(12535),v=l(1221),j=l(58121);function g(e){let{thread:t,onBack:l}=e,{t:i}=(0,b.$G)(),{user:g,isStaff:w}=(0,n.q)(),{success:N,error:y}=(0,f.useToast)(),{messages:k,loading:C}=(0,s.y_)((null==t?void 0:t.id)||null),{sendMessage:_,markAsRead:L,archiveThread:Z}=(0,s.qi)(),[U,R]=(0,r.useState)(""),[D,S]=(0,r.useState)(!1),T=(0,r.useRef)(null);(0,r.useEffect)(()=>{T.current&&(T.current.scrollTop=T.current.scrollHeight)},[k]),(0,r.useEffect)(()=>{(null==t?void 0:t.id)&&L(t.id)},[null==t?void 0:t.id,k,L]);let W=async()=>{if(t&&confirm(i("chat.archive_confirm")))try{await Z(t.id),N(i("chat.archive_success")),l&&l()}catch(e){console.error(e),y(i("chat.archive_error"))}},q=async()=>{if(!t)return;let e=t.participants.find(e=>e!==(null==g?void 0:g.uid));if(!e)return;let l=t.participantDetails[e],a=null==l?void 0:l.phone;if(!a){S(!0);try{if("Parent"===l.role&&l.clientId){let e=await (0,j.QT)((0,j.JU)(v.db,"clients",l.clientId));e.exists()&&(a=e.data().phone)}else{let t=await (0,j.QT)((0,j.JU)(v.db,"team_members",e));t.exists()&&(a=t.data().phone)}a&&t.id&&await (0,j.r7)((0,j.JU)(v.db,"threads",t.id),{["participantDetails.".concat(e,".phone")]:a})}catch(e){console.error("[ChatView] Error fetching phone number:",e)}finally{S(!1)}}a?window.location.href="tel:".concat(a):y(i("chat.no_phone"))},E=async e=>{e.preventDefault(),(null==t?void 0:t.id)&&U.trim()&&(R(""),await _(t.id,U))};if(!t)return(0,a.jsxs)("div",{className:"hidden lg:flex flex-1 flex-col items-center justify-center bg-neutral-50 dark:bg-neutral-900/50 text-neutral-500",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-neutral-100 dark:bg-neutral-800 flex items-center justify-center mb-4",children:(0,a.jsx)(d.Z,{className:"w-10 h-10"})}),(0,a.jsx)("h3",{className:"text-lg font-bold",children:i("chat.select_conversation")}),(0,a.jsx)("p",{className:"text-sm",children:i("chat.select_contact")})]});let I=t.participants.find(e=>e!==(null==g?void 0:g.uid)),A=t.participantDetails[I||""];return(0,a.jsxs)("div",{className:"flex-1 flex flex-col bg-white dark:bg-neutral-900 animate-in fade-in duration-300",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{onClick:l,className:"lg:hidden p-2 -ml-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:(0,a.jsx)(c.Z,{className:"w-5 h-5"})}),(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold shadow-sm overflow-hidden",style:{backgroundColor:(null==A?void 0:A.photoURL)?"transparent":(null==A?void 0:A.color)||"#ccc"},children:(null==A?void 0:A.photoURL)?(0,a.jsx)("img",{src:A.photoURL,alt:A.name,className:"w-full h-full object-cover"}):(null==A?void 0:A.initials)||"??"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold text-sm text-neutral-900 dark:text-white",children:(null==A?void 0:A.name)||i("chat.unknown_user")}),(0,a.jsx)("p",{className:"text-[10px] text-neutral-500 font-medium",children:(null==A?void 0:A.role)||i("common.unknown")})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[w&&(0,a.jsx)("button",{onClick:W,title:"Archive Conversation",className:"p-2 rounded-lg text-neutral-400 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:(0,a.jsx)(u.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:q,disabled:D,title:"Call",className:"p-2 rounded-lg text-neutral-400 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors disabled:opacity-50",children:D?(0,a.jsx)(x.Z,{className:"w-5 h-5 animate-spin"}):(0,a.jsx)(m.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{className:"p-2 rounded-lg text-neutral-400 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:(0,a.jsx)(h.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{className:"p-2 rounded-lg text-neutral-400 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:(0,a.jsx)(d.Z,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{ref:T,className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:[C&&0===k.length?(0,a.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,a.jsx)(x.Z,{className:"w-6 h-6 animate-spin text-primary-500"})}):k.map(e=>(0,a.jsx)(o,{message:e},e.id)),0===k.length&&!C&&(0,a.jsx)("div",{className:"h-full flex flex-col items-center justify-center text-center opacity-50 py-12",children:(0,a.jsx)("p",{className:"text-sm",children:i("chat.no_messages")})})]}),(0,a.jsx)("div",{className:"p-4 border-t border-neutral-200 dark:border-neutral-800",children:(0,a.jsxs)("form",{onSubmit:E,className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:U,onChange:e=>R(e.target.value),placeholder:i("chat.type_message"),className:"flex-1 px-4 py-2.5 bg-neutral-100 dark:bg-neutral-800 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all"}),(0,a.jsx)("button",{type:"submit",disabled:!U.trim(),className:"p-2.5 rounded-xl bg-primary-500 text-white hover:bg-primary-600 disabled:opacity-50 disabled:hover:bg-primary-500 transition-all",children:(0,a.jsx)(p.Z,{className:"w-5 h-5"})})]})})]})}},63530:function(e,t,l){l.d(t,{Z:function(){return m}});var a=l(3827),r=l(64090),n=l(52235),s=l(28670),i=l(18994),o=l(2335),d=l(7944),c=l(10207),u=l(73719),x=l(12535);function m(e){let{isOpen:t,onClose:l,onStartChat:m}=e,{t:h}=(0,x.$G)(),{user:p,isParent:f}=(0,d.q)(),b=(0,c.Sp)(),{data:v}=(0,u.m)((null==b?void 0:b.clientId)||""),{data:j,loading:g}=(0,o.lU)(),[w,N]=(0,r.useState)("");if(!t)return null;let y=j.filter(e=>{var t,l;if(e.id===(null==p?void 0:p.uid)||!((null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(w.toLowerCase()))||(null===(l=e.role)||void 0===l?void 0:l.toLowerCase().includes(w.toLowerCase()))))return!1;if(f){let t=e.id===(null==v?void 0:v.assignedTherapistId),l="Coordinator"===e.role||"Admin"===e.role;return t||l}return!0});return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-300",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-neutral-900 w-full max-w-md rounded-2xl shadow-xl overflow-hidden animate-in zoom-in-95 duration-300",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-bold text-lg text-neutral-900 dark:text-white",children:h("chat.new_conversation")}),(0,a.jsx)("button",{onClick:l,className:"p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:(0,a.jsx)(n.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(s.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400"}),(0,a.jsx)("input",{type:"text",placeholder:h("chat.search_contacts"),value:w,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-neutral-100 dark:bg-neutral-800 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all"})]})}),(0,a.jsx)("div",{className:"max-h-[400px] overflow-y-auto p-2 space-y-1 custom-scrollbar",children:g?(0,a.jsxs)("div",{className:"py-12 flex flex-col items-center justify-center text-neutral-500",children:[(0,a.jsx)(i.Z,{className:"w-8 h-8 animate-spin mb-2"}),(0,a.jsx)("p",{className:"text-sm",children:h("common.loading")})]}):0===y.length?(0,a.jsx)("div",{className:"py-12 text-center text-neutral-500",children:(0,a.jsx)("p",{className:"text-sm",children:h("chat.no_contacts")})}):y.map(e=>(0,a.jsxs)("button",{onClick:()=>{m({id:e.id,name:e.name,initials:e.initials,color:e.color,role:e.role,phone:e.phone,photoURL:e.photoURL})},className:"w-full p-3 flex items-center gap-3 hover:bg-neutral-50 dark:hover:bg-neutral-800/50 rounded-xl transition-colors text-left",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-xs shadow-sm overflow-hidden",style:{backgroundColor:e.photoURL?"transparent":e.color||"#ccc"},children:e.photoURL?(0,a.jsx)("img",{src:e.photoURL,alt:e.name,className:"w-full h-full object-cover"}):e.initials}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-sm text-neutral-900 dark:text-white",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-primary-600 dark:text-primary-400 font-medium",children:e.role})]})]},e.id))})]})})}}}]);