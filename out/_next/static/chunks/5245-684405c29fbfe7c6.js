"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5245],{18628:function(e,t,n){n.r(t),n.d(t,{AuthProvider:function(){return u},useAuth:function(){return d}});var r=n(3827),a=n(64090),i=n(27065),o=n(1221),c=n(58121),s=n(47907);let l=(0,a.createContext)({});function u(e){let{children:t}=e,[n,u]=(0,a.useState)(null),[d,g]=(0,a.useState)(null),[f,p]=(0,a.useState)(null),[y,h]=(0,a.useState)(!0),m=(0,s.useRouter)();(0,a.useEffect)(()=>{let e=null,t=(0,i.Aj)(o.I8,async t=>{u(t),e&&(e(),e=null),t?e=(0,c.cf)((0,c.JU)(o.db,"team_members",t.uid),e=>{if(e.exists()){let t=e.data();g(t),p(t.role),h(!1)}else(0,c.cf)((0,c.JU)(o.db,"clients",t.uid),e=>{e.exists()?(g(e.data()),p("Parent")):(g(null),p(null)),h(!1)})}):(g(null),p(null),h(!1))});return()=>{t(),e&&e()}},[m]);let S=async(e,t)=>{await (0,i.e5)(o.I8,e,t)},v=async()=>{await (0,i.w7)(o.I8),m.push("/login")};return(0,r.jsx)(l.Provider,{value:{user:n,userData:d,userRole:f,loading:y,signIn:S,signOut:v},children:!y&&t})}let d=()=>(0,a.useContext)(l)},2335:function(e,t,n){n.d(t,{HX:function(){return y},Nx:function(){return f},Rn:function(){return p},Su:function(){return u},av:function(){return s},b$:function(){return d},bI:function(){return m},gV:function(){return S},hI:function(){return c},lU:function(){return l},we:function(){return g},wm:function(){return h}});var r=n(64090),a=n(58121),i=n(1221);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],[n,o]=(0,r.useState)([]),[c,s]=(0,r.useState)(!0),[l,u]=(0,r.useState)(null);return(0,r.useEffect)(()=>{s(!0);let n=(0,a.IO)((0,a.hJ)(i.db,e),...t),r=(0,a.cf)(n,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t),s(!1)},t=>{console.error("Error fetching ".concat(e,":"),t),u(t.message),s(!1)});return()=>r()},[e]),{data:n,loading:c,error:l}}function c(){return o("events")}function s(){return o("clients")}function l(){return o("team_members")}function u(){return o("services")}function d(){return o("programs")}function g(e){let[t,n]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[s,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e){c(!1);return}let t=(0,a.IO)((0,a.hJ)(i.db,"events"),(0,a.ar)("clientId","==",e),(0,a.Xo)("startTime","asc")),r=(0,a.cf)(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),n(t),c(!1)},e=>{console.error("Error fetching client events:",e),l(e.message),c(!1)});return()=>r()},[e]),{data:t,loading:o,error:s}}function f(e,t){let[n,o]=(0,r.useState)([]),[c,s]=(0,r.useState)(!0),[l,u]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let n=new Date(e,t,1),r=new Date(e,t+1,0,23,59,59,999),c=(0,a.IO)((0,a.hJ)(i.db,"events"),(0,a.ar)("startTime",">=",n.toISOString()),(0,a.ar)("startTime","<=",r.toISOString()),(0,a.Xo)("startTime","asc")),l=(0,a.cf)(c,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t),s(!1)},e=>{console.error("Error fetching events by month:",e),u(e.message),s(!1)});return()=>l()},[e,t]),{data:n,loading:c,error:l}}function p(e){let[t,n]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[s,l]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!e){n([]),c(!1);return}let t=(0,a.IO)((0,a.hJ)(i.db,"clients",e,"interventionPlans"),(0,a.Xo)("createdAt","desc")),r=(0,a.cf)(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),n(t),c(!1)},e=>{console.error("Error fetching intervention plans:",e),l(e.message),c(!1)});return()=>r()},[e]);let u=t.find(e=>"active"===e.status)||null;return{data:t,loading:o,error:s,activePlan:u,getActivePlanForDate:e=>t.find(t=>{if("active"!==t.status)return!1;let n=new Date(t.startDate),r=new Date(t.endDate);return r.setHours(23,59,59,999),e>=n&&e<=r})||null}}function y(){let[e,t]=(0,r.useState)(null),[n,o]=(0,r.useState)(!0),[c,s]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=(0,a.cf)((0,a.JU)(i.db,"system_settings","config"),e=>{e.exists()?t(e.data()):t(null),o(!1)},e=>{console.error("Error fetching system settings:",e),s(e.message),o(!1)});return()=>e()},[]),{data:e,loading:n,error:c}}function h(e){let[t,n]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[s,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e){c(!1);return}let t=(0,a.IO)((0,a.hJ)(i.db,"invoices"),(0,a.ar)("clientId","==",e),(0,a.Xo)("date","desc")),r=(0,a.cf)(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),n(t),c(!1)},e=>{console.error("Error fetching client invoices:",e),l(e.message),c(!1)});return()=>r()},[e]),{data:t,loading:o,error:s}}function m(e,t){let[n,o]=(0,r.useState)([]),[c,s]=(0,r.useState)(!0),[l,u]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let n="".concat(e,"-").concat(String(t+1).padStart(2,"0"),"-01"),r="".concat(e,"-").concat(String(t+1).padStart(2,"0"),"-31"),c=(0,a.IO)((0,a.hJ)(i.db,"invoices"),(0,a.ar)("date",">=",n),(0,a.ar)("date","<=",r),(0,a.Xo)("date","desc")),l=(0,a.cf)(c,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t),s(!1)},e=>{console.error("Error fetching monthly invoices:",e),u(e.message),s(!1)});return()=>l()},[e,t]),{data:n,loading:c,error:l}}function S(e,t){let[n,o]=(0,r.useState)([]),[c,s]=(0,r.useState)(!0),[l,u]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let n="".concat(e,"-").concat(String(t+1).padStart(2,"0")),r=(0,a.IO)((0,a.hJ)(i.db,"payouts"),(0,a.ar)("month","==",n)),c=(0,a.cf)(r,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t),s(!1)},e=>{console.error("Error fetching monthly payouts:",e),u(e.message),s(!1)});return()=>c()},[e,t]),{data:n,loading:c,error:l}}},1221:function(e,t,n){n.d(t,{Fw:function(){return g},I8:function(){return l},db:function(){return u},tO:function(){return d}});var r=n(26142),a=n(27065),i=n(58121),o=n(24905),c=n(76079);let s=0===(0,r.C6)().length?(0,r.ZF)({apiKey:"AIzaSyBLyN1jo8PpJ5OMtkEuC4auhuuviapB3Bs",authDomain:"tempo-app-2.firebaseapp.com",projectId:"tempo-app-2",storageBucket:"tempo-app-2.firebasestorage.app",messagingSenderId:"47813899076",appId:"1:47813899076:web:cd597912a0755195241d11"}):(0,r.C6)()[0],l=(0,a.v0)(s),u=(0,i.ad)(s),d=(0,o.cF)(s),g=(0,c.KL)(s)},12228:function(e,t,n){n.d(t,{EK:function(){return l},FD:function(){return s},Im:function(){return f},LI:function(){return p},Q_:function(){return m},Wg:function(){return d},ag:function(){return u},bP:function(){return o},co:function(){return S},ct:function(){return g},i0:function(){return c},iK:function(){return h},kE:function(){return y},uD:function(){return v}});var r=n(58121),a=n(1221);async function i(e){let t={...e,createdAt:r.EK.now(),read:!1};console.log("[NotificationService] Creating notification:",t);let n=await (0,r.ET)((0,r.hJ)(a.db,"notifications"),t);return console.log("[NotificationService] Created notification with ID:",n.id),n.id}async function o(e){if(0===e.length){console.log("[NotificationService] No notifications to create (empty array)");return}console.log("[NotificationService] Creating batch of",e.length,"notifications"),console.log("[NotificationService] Recipients:",e.map(e=>e.recipientId));let t=(0,r.qs)(a.db);e.forEach(e=>{let n=(0,r.JU)((0,r.hJ)(a.db,"notifications"));t.set(n,{...e,createdAt:r.EK.now(),read:!1})}),await t.commit(),console.log("[NotificationService] Batch committed successfully")}async function c(e,t){let n=new Date(t.startTime),r=n.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),a=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),i=e.filter(e=>e!==t.triggeredByUserId).map(e=>({recipientId:e,recipientRole:"therapist",type:"schedule_created",category:"schedule",title:"New Session Scheduled",message:"".concat(t.eventType," session").concat(t.clientName?" with ".concat(t.clientName):""," on ").concat(r," at ").concat(a),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Calendar",type:"navigate",route:"/calendar"}]}));await o(i)}async function s(e,t){let n=new Date(t.startTime);t.oldStartTime;let r=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),a=n.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),i=e.filter(e=>e!==t.triggeredByUserId).map(e=>({recipientId:e,recipientRole:"therapist",type:"schedule_updated",category:"schedule",title:"Session Rescheduled",message:"".concat(t.eventType).concat(t.clientName?" with ".concat(t.clientName):""," moved to ").concat(a," at ").concat(r),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Calendar",type:"navigate",route:"/calendar"}]}));await o(i)}async function l(e,t){let n=new Date(t.startTime).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),r=e.filter(e=>e!==t.triggeredByUserId).map(e=>({recipientId:e,recipientRole:"therapist",type:"schedule_cancelled",category:"schedule",title:"Session Cancelled",message:"".concat(t.eventType).concat(t.clientName?" with ".concat(t.clientName):""," on ").concat(n," has been cancelled"),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Calendar",type:"navigate",route:"/calendar"}]}));await o(r)}async function u(e,t){let n=e.filter(e=>e!==t.triggeredByUserId).map(e=>({recipientId:e,recipientRole:"admin",type:"attendance_logged",category:"attendance",title:"Attendance Logged",message:"".concat(t.clientName||"Client"," marked as ").concat(t.attendance," for ").concat(t.eventType," session"),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Details",type:"navigate",route:"/calendar"}]}));await o(n)}async function d(e,t){e!==t.triggeredByUserId&&await i({recipientId:e,recipientRole:"therapist",type:"client_assigned",category:"client",title:"New Client Assigned",message:"You have been assigned to work with ".concat(t.clientName),sourceType:"client",sourceId:t.clientId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Client",type:"navigate",route:"/clients"}]})}async function g(e){try{var t;let n=await (0,r.QT)((0,r.JU)(a.db,"clients",e));if(!n.exists())return console.log("[NotificationService] Client not found:",e),[];let i=(null===(t=n.data())||void 0===t?void 0:t.parentUids)||[];return console.log("[NotificationService] Found parent UIDs for client",e,":",i),i}catch(e){return console.error("[NotificationService] Error getting parent UIDs:",e),[]}}async function f(e,t){let n=await g(e);if(0===n.length){console.log("[NotificationService] No parent UIDs found for client:",e);return}let r=new Date(t.startTime),a=r.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),i=r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),c=n.map(e=>({recipientId:e,recipientRole:"parent",type:"schedule_created",category:"schedule",title:"New Session Scheduled",message:"".concat(t.eventType," session").concat(t.therapistName?" with ".concat(t.therapistName):""," on ").concat(a," at ").concat(i),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Schedule",type:"navigate",route:"/parent/calendar/"}]}));await o(c),console.log("[NotificationService] Sent session created notifications to",n.length,"parents")}async function p(e,t){let n=await g(e);if(0===n.length)return;let r=new Date(t.startTime),a=r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),i=r.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),c=n.map(e=>({recipientId:e,recipientRole:"parent",type:"schedule_updated",category:"schedule",title:"Session Rescheduled",message:"".concat(t.eventType," session moved to ").concat(i," at ").concat(a),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Schedule",type:"navigate",route:"/parent/calendar/"}]}));await o(c),console.log("[NotificationService] Sent session rescheduled notifications to",n.length,"parents")}async function y(e,t){let n=await g(e);if(0===n.length)return;let r=new Date(t.startTime).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),a=n.map(e=>({recipientId:e,recipientRole:"parent",type:"schedule_cancelled",category:"schedule",title:"Session Cancelled",message:"".concat(t.eventType," session on ").concat(r," has been cancelled"),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Schedule",type:"navigate",route:"/parent/calendar/"}]}));await o(a),console.log("[NotificationService] Sent session cancelled notifications to",n.length,"parents")}async function h(e,t){let n=await g(e);if(0===n.length)return;let r=new Date(t.startTime).toLocaleDateString("en-US",{month:"short",day:"numeric"}),a=n.map(e=>({recipientId:e,recipientRole:"parent",type:"attendance_logged",category:"attendance",title:"Session Complete",message:"".concat(t.eventType," session on ").concat(r," - Attendance: ").concat(t.attendance),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Progress",type:"navigate",route:"/parent/progress/"}]}));await o(a),console.log("[NotificationService] Sent attendance notifications to",n.length,"parents")}async function m(e,t){let n=await g(e);if(0===n.length)return;let r=n.map(e=>({recipientId:e,recipientRole:"parent",type:"billing_generated",category:"billing",title:"Invoice Ready",message:"Your ".concat(t.period," invoice is ready (").concat(t.amount.toFixed(2)," RON)"),sourceType:"billing",sourceId:t.invoiceId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Invoice",type:"navigate",route:"/parent/billing/"}]}));await o(r),console.log("[NotificationService] Sent invoice notifications to",n.length,"parents")}async function S(e,t){let n=await g(e);if(0===n.length){console.log("[NotificationService] No parent UIDs found for client:",e);return}let r=n.map(e=>({recipientId:e,recipientRole:"parent",type:"document_shared",category:"client",title:"New Document Available",message:"".concat(t.sharedByName," shared a ").concat(t.documentCategory.toLowerCase(),': "').concat(t.documentName,'"'),sourceType:"client",sourceId:t.documentId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Documents",type:"navigate",route:"/parent/docs/"}]}));await o(r),console.log("[NotificationService] Sent document shared notifications to",n.length,"parents")}async function v(e,t,n){e!==n.triggeredByUserId&&await i({recipientId:e,recipientRole:t,type:"message_received",category:"message",title:"New Message from ".concat(n.senderName),message:n.text.length>50?n.text.substring(0,47)+"...":n.text,sourceType:"system",sourceId:n.threadId,triggeredBy:n.triggeredByUserId,actions:[{label:"Reply",type:"navigate",route:"parent"===t?"/parent/messages/":"/messages"}]})}}}]);