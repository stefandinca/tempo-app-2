"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6292],{53879:function(e,t,r){r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(87461).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},28814:function(e,t,r){r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(87461).Z)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},85904:function(e,t,r){r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(87461).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},70094:function(e,t,r){r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(87461).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},28670:function(e,t,r){r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(87461).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},52235:function(e,t,r){r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(87461).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},47907:function(e,t,r){var n=r(15313);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},30028:function(e,t,r){r.d(t,{Z:function(){return o}});var n=r(3827),a=r(7944),l=r(75504),i=r(70094),s=r(28670);function o(e){let{threads:t,activeThreadId:r,onSelectThread:o,onNewChat:u}=e,{user:d}=(0,a.q)();return(0,n.jsxs)("div",{className:"w-full lg:w-80 border-r border-neutral-200 dark:border-neutral-800 flex flex-col bg-white dark:bg-neutral-900",children:[(0,n.jsxs)("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[(0,n.jsx)("h2",{className:"font-bold text-lg text-neutral-900 dark:text-white",children:"Messages"}),(0,n.jsx)("button",{onClick:u,className:"p-2 rounded-full bg-primary-50 dark:bg-primary-900/20 text-primary-600 hover:bg-primary-100 transition-colors",children:(0,n.jsx)(i.Z,{className:"w-5 h-5"})})]}),(0,n.jsx)("div",{className:"p-4",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(s.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400"}),(0,n.jsx)("input",{type:"text",placeholder:"Search messages...",className:"w-full pl-10 pr-4 py-2 bg-neutral-100 dark:bg-neutral-800 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all"})]})}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[t.map(e=>{var t,a;let i=e.participants.find(e=>e!==(null==d?void 0:d.uid)),s=e.participantDetails[i||""],u=e.lastMessage&&!e.lastMessage.readBy.includes((null==d?void 0:d.uid)||"");return(0,n.jsxs)("button",{onClick:()=>o(e.id),className:(0,l.W)("w-full p-4 flex items-start gap-3 hover:bg-neutral-50 dark:hover:bg-neutral-800/50 transition-colors text-left border-b border-neutral-50 dark:border-neutral-800/50",r===e.id&&"bg-primary-50/50 dark:bg-primary-900/10 border-l-4 border-l-primary-500"),children:[(0,n.jsx)("div",{className:"w-12 h-12 rounded-full flex-shrink-0 flex items-center justify-center text-white font-bold shadow-sm",style:{backgroundColor:(null==s?void 0:s.color)||"#ccc"},children:(null==s?void 0:s.initials)||"??"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,n.jsx)("h3",{className:(0,l.W)("font-bold text-sm truncate",u?"text-neutral-900 dark:text-white":"text-neutral-700 dark:text-neutral-300"),children:(null==s?void 0:s.name)||"Unknown"}),(0,n.jsx)("span",{className:"text-[10px] text-neutral-400",children:null===(t=e.updatedAt)||void 0===t?void 0:t.toDate().toLocaleDateString([],{month:"short",day:"numeric"})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("p",{className:(0,l.W)("text-xs truncate pr-4",u?"font-bold text-neutral-900 dark:text-white":"text-neutral-500 dark:text-neutral-400"),children:(null===(a=e.lastMessage)||void 0===a?void 0:a.text)||"Started a conversation"}),u&&(0,n.jsx)("div",{className:"w-2 h-2 rounded-full bg-primary-500 flex-shrink-0"})]})]})]},e.id)}),0===t.length&&(0,n.jsxs)("div",{className:"text-center py-12 px-4",children:[(0,n.jsx)("p",{className:"text-sm text-neutral-500",children:"No conversations yet."}),(0,n.jsx)("button",{onClick:u,className:"mt-2 text-sm text-primary-600 font-medium hover:underline",children:"Start chatting"})]})]})]})}},42612:function(e,t,r){r.d(t,{Z:function(){return p}});var n=r(3827),a=r(64090),l=r(7944),i=r(53311),s=r(75504);function o(e){var t;let{message:r}=e,{user:a}=(0,l.q)(),i=r.senderId===(null==a?void 0:a.uid);return(0,n.jsx)("div",{className:(0,s.W)("flex w-full mb-4 animate-in fade-in slide-in-from-bottom-2 duration-300",i?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:(0,s.W)("max-w-[75%] px-4 py-2 rounded-2xl shadow-sm",i?"bg-primary-500 text-white rounded-tr-none":"bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 rounded-tl-none"),children:[(0,n.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:r.text}),(0,n.jsx)("p",{className:(0,s.W)("text-[10px] mt-1 text-right opacity-70",i?"text-primary-100":"text-neutral-500"),children:(null===(t=r.timestamp)||void 0===t?void 0:t.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))||"sending..."})]})})}var u=r(28814),d=r(53879),c=r(85904),m=r(87461);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,m.Z)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);var h=r(18994);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=(0,m.Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);function p(e){let{thread:t,onBack:r}=e,{user:s}=(0,l.q)(),{messages:m,loading:p}=(0,i.y_)((null==t?void 0:t.id)||null),{sendMessage:v,markAsRead:g}=(0,i.qi)(),[b,y]=(0,a.useState)(""),j=(0,a.useRef)(null);(0,a.useEffect)(()=>{j.current&&(j.current.scrollTop=j.current.scrollHeight)},[m]),(0,a.useEffect)(()=>{(null==t?void 0:t.id)&&g(t.id)},[null==t?void 0:t.id,m,g]);let w=async e=>{e.preventDefault(),(null==t?void 0:t.id)&&b.trim()&&(y(""),await v(t.id,b))};if(!t)return(0,n.jsxs)("div",{className:"hidden lg:flex flex-1 flex-col items-center justify-center bg-neutral-50 dark:bg-neutral-900/50 text-neutral-500",children:[(0,n.jsx)("div",{className:"w-20 h-20 rounded-full bg-neutral-100 dark:bg-neutral-800 flex items-center justify-center mb-4",children:(0,n.jsx)(u.Z,{className:"w-10 h-10"})}),(0,n.jsx)("h3",{className:"text-lg font-bold",children:"Select a conversation"}),(0,n.jsx)("p",{className:"text-sm",children:"Choose a contact to start messaging"})]});let N=t.participants.find(e=>e!==(null==s?void 0:s.uid)),k=t.participantDetails[N||""];return(0,n.jsxs)("div",{className:"flex-1 flex flex-col bg-white dark:bg-neutral-900 animate-in fade-in duration-300",children:[(0,n.jsxs)("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("button",{onClick:r,className:"lg:hidden p-2 -ml-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:(0,n.jsx)(d.Z,{className:"w-5 h-5"})}),(0,n.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold shadow-sm",style:{backgroundColor:(null==k?void 0:k.color)||"#ccc"},children:(null==k?void 0:k.initials)||"??"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-bold text-sm text-neutral-900 dark:text-white",children:(null==k?void 0:k.name)||"Unknown User"}),(0,n.jsx)("p",{className:"text-[10px] text-neutral-500 font-medium",children:(null==k?void 0:k.role)||"Staff"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("button",{className:"p-2 rounded-lg text-neutral-400 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:(0,n.jsx)(c.Z,{className:"w-5 h-5"})}),(0,n.jsx)("button",{className:"p-2 rounded-lg text-neutral-400 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:(0,n.jsx)(f,{className:"w-5 h-5"})}),(0,n.jsx)("button",{className:"p-2 rounded-lg text-neutral-400 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:(0,n.jsx)(u.Z,{className:"w-5 h-5"})})]})]}),(0,n.jsxs)("div",{ref:j,className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:[p&&0===m.length?(0,n.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,n.jsx)(h.Z,{className:"w-6 h-6 animate-spin text-primary-500"})}):m.map(e=>(0,n.jsx)(o,{message:e},e.id)),0===m.length&&!p&&(0,n.jsx)("div",{className:"h-full flex flex-col items-center justify-center text-center opacity-50 py-12",children:(0,n.jsx)("p",{className:"text-sm",children:"No messages yet. Say hello!"})})]}),(0,n.jsx)("div",{className:"p-4 border-t border-neutral-200 dark:border-neutral-800",children:(0,n.jsxs)("form",{onSubmit:w,className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"text",value:b,onChange:e=>y(e.target.value),placeholder:"Type a message...",className:"flex-1 px-4 py-2.5 bg-neutral-100 dark:bg-neutral-800 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all"}),(0,n.jsx)("button",{type:"submit",disabled:!b.trim(),className:"p-2.5 rounded-xl bg-primary-500 text-white hover:bg-primary-600 disabled:opacity-50 disabled:hover:bg-primary-500 transition-all",children:(0,n.jsx)(x,{className:"w-5 h-5"})})]})})]})}},63530:function(e,t,r){r.d(t,{Z:function(){return m}});var n=r(3827),a=r(64090),l=r(52235),i=r(28670),s=r(18994),o=r(2335),u=r(7944),d=r(10207),c=r(73719);function m(e){let{isOpen:t,onClose:r,onStartChat:m}=e,{user:f,isParent:h}=(0,u.q)(),x=(0,d.Sp)(),{data:p}=(0,c.m)((null==x?void 0:x.clientId)||""),{data:v,loading:g}=(0,o.lU)(),[b,y]=(0,a.useState)("");if(!t)return null;let j=v.filter(e=>{var t,r;if(e.id===(null==f?void 0:f.uid)||!((null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(b.toLowerCase()))||(null===(r=e.role)||void 0===r?void 0:r.toLowerCase().includes(b.toLowerCase()))))return!1;if(h){let t=e.id===(null==p?void 0:p.assignedTherapistId),r="Coordinator"===e.role||"Admin"===e.role;return t||r}return!0});return(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-300",children:(0,n.jsxs)("div",{className:"bg-white dark:bg-neutral-900 w-full max-w-md rounded-2xl shadow-xl overflow-hidden animate-in zoom-in-95 duration-300",children:[(0,n.jsxs)("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"font-bold text-lg text-neutral-900 dark:text-white",children:"New Conversation"}),(0,n.jsx)("button",{onClick:r,className:"p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",children:(0,n.jsx)(l.Z,{className:"w-5 h-5"})})]}),(0,n.jsx)("div",{className:"p-4",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(i.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400"}),(0,n.jsx)("input",{type:"text",placeholder:"Search team members...",value:b,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-neutral-100 dark:bg-neutral-800 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all"})]})}),(0,n.jsx)("div",{className:"max-h-[400px] overflow-y-auto p-2 space-y-1 custom-scrollbar",children:g?(0,n.jsxs)("div",{className:"py-12 flex flex-col items-center justify-center text-neutral-500",children:[(0,n.jsx)(s.Z,{className:"w-8 h-8 animate-spin mb-2"}),(0,n.jsx)("p",{className:"text-sm",children:"Loading team..."})]}):0===j.length?(0,n.jsx)("div",{className:"py-12 text-center text-neutral-500",children:(0,n.jsx)("p",{className:"text-sm",children:"No team members found."})}):j.map(e=>(0,n.jsxs)("button",{onClick:()=>{m({id:e.id,name:e.name,initials:e.initials,color:e.color,role:e.role})},className:"w-full p-3 flex items-center gap-3 hover:bg-neutral-50 dark:hover:bg-neutral-800/50 rounded-xl transition-colors text-left",children:[(0,n.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-xs shadow-sm",style:{backgroundColor:e.color||"#ccc"},children:e.initials}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-bold text-sm text-neutral-900 dark:text-white",children:e.name}),(0,n.jsx)("p",{className:"text-xs text-primary-600 dark:text-primary-400 font-medium",children:e.role})]})]},e.id))})]})})}},10207:function(e,t,r){r.d(t,{Sp:function(){return c},gx:function(){return u},jT:function(){return d}});var n=r(3827),a=r(64090),l=r(27065),i=r(1221),s=r(58121);let o=(0,a.createContext)(void 0);function u(e){let{children:t}=e,[r,u]=(0,a.useState)(null),[d,c]=(0,a.useState)(null),[m,f]=(0,a.useState)(null),[h,x]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=(0,l.Aj)(i.I8,async e=>{if(null==e?void 0:e.isAnonymous){u(e);let t=localStorage.getItem("parent_client_id"),r=localStorage.getItem("parent_client_name"),n=localStorage.getItem("parent_uid");if(t){if(n!==e.uid){console.log("[ParentAuth] UID mismatch or new session. Re-registering with client...");try{let r=(0,s.JU)(i.db,"clients",t);await (0,s.r7)(r,{parentUids:(0,s.vr)(e.uid)}),console.log("[ParentAuth] Re-registered successfully."),localStorage.setItem("parent_uid",e.uid)}catch(e){console.error("[ParentAuth] Failed to re-register UID with client:",e)}}c(t),f(r)}else c(null),f(null);x(!1)}else if(localStorage.getItem("parent_client_code")&&!e){console.log("[ParentAuth] No active session, but found stored code. Auto-logging in...");try{await (0,l.XB)(i.I8);return}catch(e){console.error("[ParentAuth] Auto-login failed:",e),x(!1)}}else u(null),c(null),f(null),x(!1)});return()=>e()},[]);let p=(0,a.useCallback)(async(e,t,r)=>{try{let n=i.I8.currentUser;n&&n.isAnonymous||(n=(await (0,l.XB)(i.I8)).user);let a=(0,s.JU)(i.db,"clients",e);await (0,s.r7)(a,{parentUids:(0,s.vr)(n.uid)}),localStorage.setItem("parent_uid",n.uid),localStorage.setItem("parent_client_id",e),localStorage.setItem("parent_client_name",t),localStorage.setItem("parent_client_code",r.toUpperCase()),u(n),c(e),f(t),console.log("[ParentAuth] Successfully authenticated parent with UID:",n.uid)}catch(e){throw console.error("[ParentAuth] Error authenticating:",e),e}},[]),v=(0,a.useCallback)(async()=>{try{localStorage.removeItem("parent_uid"),localStorage.removeItem("parent_client_id"),localStorage.removeItem("parent_client_name"),localStorage.removeItem("parent_client_code"),await (0,l.w7)(i.I8),u(null),c(null),f(null)}catch(e){console.error("[ParentAuth] Error signing out:",e)}},[]);return(0,n.jsx)(o.Provider,{value:{user:r,clientId:d,clientName:m,loading:h,isAuthenticated:null!==r&&null!==d,authenticateWithCode:p,signOut:v},children:t})}function d(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useParentAuth must be used within ParentAuthProvider");return e}function c(){return(0,a.useContext)(o)}},7944:function(e,t,r){r.d(t,{q:function(){return l}});var n=r(18628),a=r(10207);function l(){var e,t;let r=(0,a.Sp)(),l=(0,n.useAuth)();if((null==r?void 0:r.user)&&r.isAuthenticated)return{user:r.user,isParent:!0,isStaff:!1,loading:r.loading,role:"Parent"};if((null==l?void 0:l.user)&&l.userRole)return{user:l.user,isParent:!1,isStaff:!0,loading:l.loading,role:l.userRole};if(null==l?void 0:null===(e=l.user)||void 0===e?void 0:e.isAnonymous)return{user:l.user,isParent:!0,isStaff:!1,loading:l.loading,role:"Parent"};let i=(null==l?void 0:l.loading)||null!==(t=null==r?void 0:r.loading)&&void 0!==t&&t;return{user:(null==l?void 0:l.user)||(null==r?void 0:r.user)||null,isParent:!1,isStaff:!1,loading:i,role:null}}},53311:function(e,t,r){r.d(t,{KR:function(){return d},qi:function(){return m},y_:function(){return c}});var n=r(64090),a=r(58121),l=r(1221),i=r(7944),s=r(18628),o=r(10207),u=r(12228);function d(){let{user:e}=(0,i.q)(),[t,r]=(0,n.useState)([]),[s,o]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{if(!e){o(!1);return}let t=(0,a.IO)((0,a.hJ)(l.db,"threads"),(0,a.ar)("participants","array-contains",e.uid),(0,a.Xo)("updatedAt","desc")),n=(0,a.cf)(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),r(t),o(!1)});return()=>n()},[e]),{threads:t,loading:s}}function c(e){let[t,r]=(0,n.useState)([]),[i,s]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(!e){r([]);return}s(!0);let t=(0,a.IO)((0,a.hJ)(l.db,"threads",e,"messages"),(0,a.Xo)("timestamp","asc")),n=(0,a.cf)(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),r(t),s(!1)});return()=>n()},[e]),{messages:t,loading:i}}function m(){let{user:e,isParent:t,role:r}=(0,i.q)(),n=(0,s.useAuth)(),d=(0,o.Sp)();return{sendMessage:async(r,i)=>{if(!e||!i.trim())return;let s={senderId:e.uid,text:i.trim(),timestamp:(0,a.Bt)(),type:"text"};await (0,a.ET)((0,a.hJ)(l.db,"threads",r,"messages"),s),await (0,a.r7)((0,a.JU)(l.db,"threads",r),{lastMessage:{text:i.trim(),senderId:e.uid,timestamp:(0,a.Bt)(),readBy:[e.uid]},updatedAt:(0,a.Bt)()});try{let s=await (0,a.QT)((0,a.JU)(l.db,"threads",r));if(s.exists()){let a=s.data(),l=a.participants.find(t=>t!==e.uid),c=l?a.participantDetails[l]:null;if(l&&c){let s="Someone";if(t){let t=a.participantDetails[e.uid];s=(null==t?void 0:t.name)||((null==d?void 0:d.clientName)?"Parent of ".concat(d.clientName):"Parent")}else{var o;let t=a.participantDetails[e.uid];s=(null==t?void 0:t.name)||(null==n?void 0:null===(o=n.userData)||void 0===o?void 0:o.name)||"Staff Member"}await (0,u.uD)(l,c.role.toLowerCase(),{senderName:s,text:i.trim(),threadId:r,triggeredByUserId:e.uid})}}}catch(e){console.error("[useChat] Error sending notification:",e)}},createOrGetThread:async i=>{if(!e)return null;let s=[e.uid,i.id].sort().join("_"),o=(0,a.JU)(l.db,"threads",s),u=await (0,a.QT)(o);if(u.exists()){let l=u.data().participantDetails[e.uid];if(!l||"Unknown"===l.name||"Staff Member"===l.name||t&&"Parent"===l.name){let l;if(t)l={id:e.uid,name:(null==d?void 0:d.clientName)?"Parent of ".concat(d.clientName):"Parent",initials:"P",color:"#4A90E2",role:"Parent"};else{let t=null==n?void 0:n.userData;l={id:e.uid,name:(null==t?void 0:t.name)||"Staff Member",initials:(null==t?void 0:t.initials)||"S",color:(null==t?void 0:t.color)||"#ccc",role:r||"Staff"}}await (0,a.r7)(o,{["participantDetails.".concat(e.uid)]:l})}}else{let l;if(t)l={id:e.uid,name:(null==d?void 0:d.clientName)?"Parent of ".concat(d.clientName):"Parent",initials:"P",color:"#4A90E2",role:"Parent"};else{let t=null==n?void 0:n.userData;l={id:e.uid,name:(null==t?void 0:t.name)||"Staff Member",initials:(null==t?void 0:t.initials)||"S",color:(null==t?void 0:t.color)||"#ccc",role:r||"Staff"}}await (0,a.pl)(o,{participants:[e.uid,i.id],participantDetails:{[e.uid]:l,[i.id]:i},createdAt:(0,a.Bt)(),updatedAt:(0,a.Bt)()})}return s},markAsRead:async t=>{e&&await (0,a.r7)((0,a.JU)(l.db,"threads",t),{"lastMessage.readBy":(0,a.vr)(e.uid)})}}}},73719:function(e,t,r){r.d(t,{m:function(){return i}});var n=r(64090),a=r(58121),l=r(1221);function i(e){let[t,r]=(0,n.useState)(null),[i,s]=(0,n.useState)(!0),[o,u]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!e)return;s(!0);let t=(0,a.cf)((0,a.JU)(l.db,"clients",e),e=>{e.exists()?r({id:e.id,...e.data()}):u("Client not found"),s(!1)},e=>{console.error("Error fetching client:",e),u(e.message),s(!1)});return()=>t()},[e]),{data:t,loading:i,error:o}}},75504:function(e,t,r){r.d(t,{W:function(){return n}});function n(){for(var e,t,r=0,n="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=function e(t){var r,n,a="";if("string"==typeof t||"number"==typeof t)a+=t;else if("object"==typeof t){if(Array.isArray(t)){var l=t.length;for(r=0;r<l;r++)t[r]&&(n=e(t[r]))&&(a&&(a+=" "),a+=n)}else for(n in t)t[n]&&(a&&(a+=" "),a+=n)}return a}(e))&&(n&&(n+=" "),n+=t);return n}}}]);