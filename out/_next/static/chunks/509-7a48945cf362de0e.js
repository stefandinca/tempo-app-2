"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[509],{18628:function(e,t,n){n.r(t),n.d(t,{AuthProvider:function(){return l},useAuth:function(){return d}});var r=n(3827),a=n(64090),i=n(27065),o=n(1221),c=n(58121),s=n(47907);let u=(0,a.createContext)({});function l(e){let{children:t}=e,[n,l]=(0,a.useState)(null),[d,f]=(0,a.useState)(null),[g,h]=(0,a.useState)(null),[m,p]=(0,a.useState)(!0),v=(0,s.useRouter)();(0,a.useEffect)(()=>{let e=null,t=(0,i.Aj)(o.I,async t=>{l(t),e&&(e(),e=null),t?e=(0,c.cf)((0,c.JU)(o.db,"team_members",t.uid),e=>{if(e.exists()){let t=e.data();f(t),h(t.role),p(!1)}else(0,c.cf)((0,c.JU)(o.db,"clients",t.uid),e=>{e.exists()?(f(e.data()),h("Parent")):(f(null),h(null)),p(!1)})}):(f(null),h(null),p(!1))});return()=>{t(),e&&e()}},[v]);let S=async(e,t)=>{await (0,i.e5)(o.I,e,t)},y=async()=>{await (0,i.w7)(o.I),v.push("/login")};return(0,r.jsx)(u.Provider,{value:{user:n,userData:d,userRole:g,loading:m,signIn:S,signOut:y},children:!m&&t})}let d=()=>(0,a.useContext)(u)},25678:function(e,t,n){n.r(t),n.d(t,{DataProvider:function(){return u},useData:function(){return l}});var r=n(3827),a=n(64090),i=n(2335),o=n(58121),c=n(1221);let s=(0,a.createContext)({});function u(e){let{children:t}=e,n=(0,i.av)(),u=(0,i.lU)(),l=(0,i.hI)(),d=(0,i.Su)(),f=(0,i.b$)(),[g,h]=(0,a.useState)({}),[m,p]=(0,a.useState)(!0);(0,a.useEffect)(()=>{if(n.loading||0===n.data.length){p(n.loading);return}let e=[],t={};n.data.forEach(e=>{t[e.id]=null});let r=0,a=n.data.length;return n.data.forEach(t=>{let n=(0,o.IO)((0,o.hJ)(c.db,"clients",t.id,"interventionPlans")),i=(0,o.cf)(n,e=>{let n=[];e.forEach(e=>{n.push({id:e.id,...e.data()})});let i=n.find(e=>"active"===e.status)||null;h(e=>({...e,[t.id]:i})),++r>=a&&p(!1)},e=>{console.error("Error fetching plans for ".concat(t.id,":"),e),++r>=a&&p(!1)});e.push(i)}),()=>{e.forEach(e=>e())}},[n.data,n.loading]);let v=(0,a.useMemo)(()=>({getTeamMember:e=>u.data.find(t=>t.id===e),getClient:e=>n.data.find(t=>t.id===e),getService:e=>d.data.find(t=>t.id===e),getClientEvents:e=>l.data.filter(t=>t.clientId===e),getClientActivePlan:e=>g[e]||null}),[u.data,n.data,d.data,l.data,g]),S={clients:n,teamMembers:u,events:l,services:d,programs:f,activePlans:g,activePlansLoading:m,...v};return(0,r.jsx)(s.Provider,{value:S,children:t})}let l=()=>(0,a.useContext)(s)},19685:function(e,t,n){n.r(t),n.d(t,{ToastProvider:function(){return p},useToast:function(){return v}});var r=n(3827),a=n(64090),i=n(89542),o=n(46578),c=n(98998),s=n(61524),u=n(28814),l=n(52235),d=n(75504);let f={success:o.Z,error:c.Z,warning:s.Z,info:u.Z},g={success:"bg-success-500 border-success-600 text-white",error:"bg-error-500 border-error-600 text-white",warning:"bg-warning-500 border-warning-600 text-white",info:"bg-primary-500 border-primary-600 text-white"};function h(e){let{id:t,message:n,type:i,duration:o=5e3,onDismiss:c}=e,s=f[i];return(0,a.useEffect)(()=>{console.log("Toast mounted:",t);let e=setTimeout(()=>{c(t)},o);return()=>clearTimeout(e)},[o,t,c]),(0,r.jsxs)("div",{className:(0,d.W)("flex items-start gap-3 p-4 rounded-lg shadow-lg border w-80 pointer-events-auto z-[9999]",g[i]),role:"alert",children:[(0,r.jsx)(s,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),(0,r.jsx)("div",{className:"flex-1 text-sm font-medium",children:n}),(0,r.jsx)("button",{onClick:()=>c(t),className:"text-white/80 hover:text-white transition-colors",children:(0,r.jsx)(l.Z,{className:"w-4 h-4"})})]})}let m=(0,a.createContext)(void 0);function p(e){let{children:t}=e,[n,o]=(0,a.useState)([]),[c,s]=(0,a.useState)(!1);(0,a.useEffect)(()=>{s(!0)},[]);let u=(0,a.useCallback)(e=>{o(t=>t.filter(t=>t.id!==e))},[]),l=(0,a.useCallback)(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;console.log("Showing toast:",e,t);let r=Math.random().toString(36).substring(2,9);o(a=>[...a,{id:r,message:e,type:t,duration:n,onDismiss:u}])},[u]),d=(0,a.useCallback)((e,t)=>l(e,"success",t),[l]),f=(0,a.useCallback)((e,t)=>l(e,"error",t),[l]),g=(0,a.useCallback)((e,t)=>l(e,"warning",t),[l]),p=(0,a.useCallback)((e,t)=>l(e,"info",t),[l]);return(0,r.jsxs)(m.Provider,{value:{showToast:l,success:d,error:f,warning:g,info:p},children:[t,c&&"undefined"!=typeof document&&(0,i.createPortal)((0,r.jsx)("div",{className:"fixed top-4 right-4 flex flex-col gap-2 max-h-screen pointer-events-none",style:{zIndex:999999},children:n.map(e=>(0,r.jsx)("div",{className:"pointer-events-auto animate-in slide-in-from-right-full fade-in duration-300",children:(0,r.jsx)(h,{...e})},e.id))}),document.body)]})}function v(){let e=(0,a.useContext)(m);if(!e)throw Error("useToast must be used within a ToastProvider");return e}},2335:function(e,t,n){n.d(t,{HX:function(){return m},Nx:function(){return g},Rn:function(){return h},Su:function(){return l},av:function(){return s},b$:function(){return d},bI:function(){return v},gV:function(){return S},hI:function(){return c},lU:function(){return u},we:function(){return f},wm:function(){return p}});var r=n(64090),a=n(58121),i=n(1221);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],[n,o]=(0,r.useState)([]),[c,s]=(0,r.useState)(!0),[u,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{s(!0);let n=(0,a.IO)((0,a.hJ)(i.db,e),...t),r=(0,a.cf)(n,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t),s(!1)},t=>{console.error("Error fetching ".concat(e,":"),t),l(t.message),s(!1)});return()=>r()},[e]),{data:n,loading:c,error:u}}function c(){return o("events")}function s(){return o("clients")}function u(){return o("team_members")}function l(){return o("services")}function d(){return o("programs")}function f(e){let[t,n]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[s,u]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e){c(!1);return}let t=(0,a.IO)((0,a.hJ)(i.db,"events"),(0,a.ar)("clientId","==",e),(0,a.Xo)("startTime","asc")),r=(0,a.cf)(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),n(t),c(!1)},e=>{console.error("Error fetching client events:",e),u(e.message),c(!1)});return()=>r()},[e]),{data:t,loading:o,error:s}}function g(e,t){let[n,o]=(0,r.useState)([]),[c,s]=(0,r.useState)(!0),[u,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let n=new Date(e,t,1),r=new Date(e,t+1,0,23,59,59,999),c=(0,a.IO)((0,a.hJ)(i.db,"events"),(0,a.ar)("startTime",">=",n.toISOString()),(0,a.ar)("startTime","<=",r.toISOString()),(0,a.Xo)("startTime","asc")),u=(0,a.cf)(c,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t),s(!1)},e=>{console.error("Error fetching events by month:",e),l(e.message),s(!1)});return()=>u()},[e,t]),{data:n,loading:c,error:u}}function h(e){let[t,n]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[s,u]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!e){n([]),c(!1);return}let t=(0,a.IO)((0,a.hJ)(i.db,"clients",e,"interventionPlans"),(0,a.Xo)("createdAt","desc")),r=(0,a.cf)(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),n(t),c(!1)},e=>{console.error("Error fetching intervention plans:",e),u(e.message),c(!1)});return()=>r()},[e]);let l=t.find(e=>"active"===e.status)||null;return{data:t,loading:o,error:s,activePlan:l,getActivePlanForDate:e=>t.find(t=>{if("active"!==t.status)return!1;let n=new Date(t.startDate),r=new Date(t.endDate);return r.setHours(23,59,59,999),e>=n&&e<=r})||null}}function m(){let[e,t]=(0,r.useState)(null),[n,o]=(0,r.useState)(!0),[c,s]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=(0,a.cf)((0,a.JU)(i.db,"system_settings","config"),e=>{e.exists()?t(e.data()):t(null),o(!1)},e=>{console.error("Error fetching system settings:",e),s(e.message),o(!1)});return()=>e()},[]),{data:e,loading:n,error:c}}function p(e){let[t,n]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[s,u]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(!e){c(!1);return}let t=(0,a.IO)((0,a.hJ)(i.db,"invoices"),(0,a.ar)("clientId","==",e),(0,a.Xo)("date","desc")),r=(0,a.cf)(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),n(t),c(!1)},e=>{console.error("Error fetching client invoices:",e),u(e.message),c(!1)});return()=>r()},[e]),{data:t,loading:o,error:s}}function v(e,t){let[n,o]=(0,r.useState)([]),[c,s]=(0,r.useState)(!0),[u,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let n="".concat(e,"-").concat(String(t+1).padStart(2,"0"),"-01"),r="".concat(e,"-").concat(String(t+1).padStart(2,"0"),"-31"),c=(0,a.IO)((0,a.hJ)(i.db,"invoices"),(0,a.ar)("date",">=",n),(0,a.ar)("date","<=",r),(0,a.Xo)("date","desc")),u=(0,a.cf)(c,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t),s(!1)},e=>{console.error("Error fetching monthly invoices:",e),l(e.message),s(!1)});return()=>u()},[e,t]),{data:n,loading:c,error:u}}function S(e,t){let[n,o]=(0,r.useState)([]),[c,s]=(0,r.useState)(!0),[u,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let n="".concat(e,"-").concat(String(t+1).padStart(2,"0")),r=(0,a.IO)((0,a.hJ)(i.db,"payouts"),(0,a.ar)("month","==",n)),c=(0,a.cf)(r,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),o(t),s(!1)},e=>{console.error("Error fetching monthly payouts:",e),l(e.message),s(!1)});return()=>c()},[e,t]),{data:n,loading:c,error:u}}},1221:function(e,t,n){n.d(t,{I:function(){return c},db:function(){return s}});var r=n(26142),a=n(27065),i=n(58121);let o=0===(0,r.C6)().length?(0,r.ZF)({apiKey:"AIzaSyBLyN1jo8PpJ5OMtkEuC4auhuuviapB3Bs",authDomain:"tempo-app-2.firebaseapp.com",projectId:"tempo-app-2",storageBucket:"tempo-app-2.firebasestorage.app",messagingSenderId:"47813899076",appId:"1:47813899076:web:cd597912a0755195241d11"}):(0,r.C6)()[0],c=(0,a.v0)(o),s=(0,i.ad)(o)},12228:function(e,t,n){n.d(t,{EK:function(){return s},FD:function(){return c},ag:function(){return u},i0:function(){return o}});var r=n(58121),a=n(1221);async function i(e){if(0===e.length){console.log("[NotificationService] No notifications to create (empty array)");return}console.log("[NotificationService] Creating batch of",e.length,"notifications"),console.log("[NotificationService] Recipients:",e.map(e=>e.recipientId));let t=(0,r.qs)(a.db);e.forEach(e=>{let n=(0,r.JU)((0,r.hJ)(a.db,"notifications"));t.set(n,{...e,createdAt:r.EK.now(),read:!1})}),await t.commit(),console.log("[NotificationService] Batch committed successfully")}async function o(e,t){let n=new Date(t.startTime),r=n.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),a=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),o=e.filter(e=>e!==t.triggeredByUserId).map(e=>({recipientId:e,recipientRole:"therapist",type:"schedule_created",category:"schedule",title:"New Session Scheduled",message:"".concat(t.eventType," session").concat(t.clientName?" with ".concat(t.clientName):""," on ").concat(r," at ").concat(a),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Calendar",type:"navigate",route:"/calendar"}]}));await i(o)}async function c(e,t){let n=new Date(t.startTime);t.oldStartTime;let r=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),a=n.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),o=e.filter(e=>e!==t.triggeredByUserId).map(e=>({recipientId:e,recipientRole:"therapist",type:"schedule_updated",category:"schedule",title:"Session Rescheduled",message:"".concat(t.eventType).concat(t.clientName?" with ".concat(t.clientName):""," moved to ").concat(a," at ").concat(r),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Calendar",type:"navigate",route:"/calendar"}]}));await i(o)}async function s(e,t){let n=new Date(t.startTime).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),r=e.filter(e=>e!==t.triggeredByUserId).map(e=>({recipientId:e,recipientRole:"therapist",type:"schedule_cancelled",category:"schedule",title:"Session Cancelled",message:"".concat(t.eventType).concat(t.clientName?" with ".concat(t.clientName):""," on ").concat(n," has been cancelled"),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Calendar",type:"navigate",route:"/calendar"}]}));await i(r)}async function u(e,t){let n=e.filter(e=>e!==t.triggeredByUserId).map(e=>({recipientId:e,recipientRole:"admin",type:"attendance_logged",category:"attendance",title:"Attendance Logged",message:"".concat(t.clientName||"Client"," marked as ").concat(t.attendance," for ").concat(t.eventType," session"),sourceType:"event",sourceId:t.eventId,triggeredBy:t.triggeredByUserId,actions:[{label:"View Details",type:"navigate",route:"/calendar"}]}));await i(n)}}}]);